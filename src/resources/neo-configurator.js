(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=jQuery;var n=t.n(e);n().fn.insertAt=function(t,e){return this.each((function(){0===t?e.prepend(this):e.children().eq(t-1).after(this)}))};const i=Garnish;var a=t.n(i);const o=Craft;var s=t.n(o);function r(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}const c={_stack:[[]],enter:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("string"==typeof t&&(t=this.fromFieldName(t)),e){var n=this.getNamespace();n.push.apply(n,r(t)),t=n}this._stack.push(t)},enterByFieldName:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.enter(this.fromFieldName(t),e)},leave:function(){return this._stack.length>1?this._stack.pop():this.getNamespace()},getNamespace:function(){return Array.from(this._stack[this._stack.length-1])},parse:function(t){return"string"==typeof t?t.indexOf("[")>-1?this.fromFieldName(t):t.indexOf("-")>-1?t.split("-"):t.indexOf(".")>-1?t.split("."):t:Array.from(t)},value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",n=this.getNamespace();return n.push(t),n.join(e)},fieldName:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.toFieldName();return e?e+t.replace(/([^'"[\]]+)([^'"]*)/,"[$1]$2"):t},toString:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-";return this.getNamespace().join(t)},toFieldName:function(){var t=this.getNamespace();switch(t.length){case 0:return"";case 1:return t[0]}return t[0]+"["+t.slice(1).join("][")+"]"},fromFieldName:function(t){return t.match(/[^[\]\s]+/g)||[]}};var d={settings:null};const u=a().Base.extend({_selected:!1,init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},d,t),this._settings=t.settings},getSettings:function(){return this._settings},select:function(){this.toggleSelect(!0)},deselect:function(){this.toggleSelect(!1)},toggleSelect:function(t){this._selected="boolean"==typeof t?t:!this._selected,this.trigger("toggleSelect",{selected:this._selected})},isSelected:function(){return this._selected}});var h={namespace:[],fieldLayout:null};const p=u.extend({_templateNs:[],init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.base(e);var n=this.getSettings();e=Object.assign({},h,e),this._templateNs=c.parse(e.namespace),this._fieldLayout=e.fieldLayout,this.$container=this._generateBlockType(n);var i=this.$container.find("[data-neo-bt]");this.$nameText=i.filter('[data-neo-bt="text.name"]'),this.$moveButton=i.filter('[data-neo-bt="button.move"]'),this.$actionsButton=i.filter('[data-neo-bt="button.actions"]'),this.$actionsMenu=i.filter('[data-neo-bt="container.menu"]'),this._actionsMenu=new(a().MenuBtn)(this.$actionsButton),this._actionsMenu.on("optionSelect",(function(e){return t["@actionSelect"](e)})),this.addListener(this.$actionsButton,"click",(function(t){return t.stopPropagation()})),n&&(n.on("change",(function(){return t._updateTemplate()})),n.on("destroy",(function(){return t.trigger("destroy")})),this._updateTemplate()),this.deselect()},_generateBlockType:function(t){var e=t.getErrors(),i=(Array.isArray(e)?e:Object.keys(e)).length>0;return n()('\n      <div class="nc_sidebar_list_item'.concat(i?" has-errors":"",'">\n        <div class="label" data-neo-bt="text.name">').concat(t.getName(),'</div>\n        <a class="move icon" title="').concat(s().t("neo","Reorder"),'" role="button" data-neo-bt="button.move"></a>\n        <button class="settings icon menubtn" title="').concat(s().t("neo","Actions"),'" role="button" type="button" data-neo-bt="button.actions"></button>\n        <div class="menu" data-neo-bt="container.menu">\n          <ul class="padded">\n            <li><a data-icon="field" data-action="copy">').concat(s().t("neo","Copy"),'</a></li>\n            <li class="disabled"><a data-icon="brush" data-action="paste">').concat(s().t("neo","Paste"),'</a></li>\n            <li><a data-icon="share" data-action="clone">').concat(s().t("neo","Clone"),'</a></li>\n            <li><a class="error" data-icon="remove" data-action="delete">').concat(s().t("neo","Delete"),"</a></li>\n          </ul>\n        </div>\n      </div>"))},getFieldLayout:function(){return this._fieldLayout},toggleSelect:function(t){this.base(t);var e=this.getSettings(),n=this.getFieldLayout(),i=this.isSelected();e&&e.$container.toggleClass("hidden",!i),n&&n.$container.toggleClass("hidden",!i),this.$container.toggleClass("is-selected",i)},_updateTemplate:function(){var t=this.getSettings(),e=this.getFieldLayout();t&&(this.$nameText.text(t.getName()),this.$container.toggleClass("is-child",!t.getTopLevel()),e&&e.setBlockName(t.getName()))},"@actionSelect":function(t){var e=n()(t.option);if(!e.hasClass("disabled"))switch(e.attr("data-action")){case"copy":this.trigger("copy");break;case"paste":this.trigger("paste");break;case"clone":this.trigger("clone");break;case"delete":window.confirm(s().t("neo","Are you sure you want to delete this block type?"))&&this.getSettings().destroy()}}});function f(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var g={id:!1,label:!1,instructions:!1,required:!1,locale:!1,input:"",warning:!1,errors:!1},v={type:"text",attributes:{},id:"",name:"",value:"",class:"",fullWidth:!0},y={attributes:{},name:"",checked:!1};const b=a().Base.extend({$container:new(n()),_sortOrder:0,getSortOrder:function(){return this._sortOrder},setSortOrder:function(t){var e=this._sortOrder;this._sortOrder=0|t,e!==this._sortOrder&&this.trigger("change",{property:"sortOrder",oldValue:e,newValue:this._sortOrder})},getFocusElement:function(){return new(n())},destroy:function(){this.trigger("destroy")},_field:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},g,t);var e=[];if(e.push('\n      <div class="field">'),(t.label||t.instructions)&&(t.label&&(e.push('\n        <div class="heading">\n          <label'.concat(t.required?' class="required"':"").concat(t.id?' for="'.concat(t.id,'"'):"",">\n            ").concat(t.label)),t.locale&&e.push('\n            <span class="locale">'.concat(t.locale,"</span>")),e.push("\n          </label>\n        </div>")),t.instructions&&e.push('\n        <div class="instructions">'.concat(t.instructions,"</div>"))),e.push('\n        <div class="input'.concat(t.errors?" errors":"",'">\n          ').concat(t.input,"\n        </div>")),t.warning&&e.push('\n        <p class="warning">'.concat(t.warning,"</p>")),t.errors){e.push('\n        <ul class="errors">');var n,i=f(t.errors);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.push("\n          <li>".concat(a,"</li>"))}}catch(t){i.e(t)}finally{i.f()}e.push("\n        </ul>")}return e.push("\n      </div>"),e.join("")},_input:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t=Object.assign({},v,t)).input='\n      <input class="text'.concat(t.fullWidth?" fullwidth":""," ").concat(t.class,'"\n             type="').concat(t.type,'"\n             id="').concat(t.id,'"\n             name="').concat(t.name,'"\n             value="').concat(t.value,'"\n             ').concat(this._attributes(t.attributes),'\n             autocomplete="off">'),this._field(t)},_lightswitch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(t=Object.assign({},y,t)).input='\n      <div class="lightswitch'.concat(t.checked?" on":"",'" tabindex="0"').concat(this._attributes(t.attributes),'>\n        <div class="lightswitch-container">\n          <div class="label on"></div>\n          <div class="handle"></div>\n          <div class="label off"></div>\n        </div>\n        <input type="hidden" name="').concat(t.name,'" value="').concat(t.checked?"1":"",'">\n      </div>'),this._field(t)},_attributes:function(t){var e=[];for(var n in t)e.push(" ".concat(n,'="').concat(t[n],'"'));return e.join("")}});function k(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return B(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var _={namespace:[],id:null,sortOrder:0,name:"",handle:"",maxBlocks:0,maxSiblingBlocks:0,maxChildBlocks:0,topLevel:!0,childBlocks:null,childBlockTypes:[],errors:{}};const x=b.extend({_templateNs:[],_childBlockTypes:[],$sortOrderInput:new(n()),$nameInput:new(n()),$handleInput:new(n()),$maxBlocksInput:new(n()),$maxSiblingBlocksInput:new(n()),$maxChildBlocksInput:new(n()),init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},_,e),this._templateNs=c.parse(e.namespace),this._childBlockTypes=[],this._id=e.id,this._errors=e.errors,this.setSortOrder(e.sortOrder),this.setName(e.name),this.setHandle(e.handle),this.setMaxBlocks(e.maxBlocks),this.setMaxSiblingBlocks(e.maxSiblingBlocks),this.setMaxChildBlocks(e.maxChildBlocks),this.setTopLevel(e.topLevel),this.$container=this._generateBlockTypeSettings();var n=this.$container.find("[data-neo-bts]");this.$sortOrderInput=n.filter('[data-neo-bts="input.sortOrder"]'),this.$nameInput=n.filter('[data-neo-bts="input.name"]'),this.$handleInput=n.filter('[data-neo-bts="input.handle"]'),this.$maxBlocksInput=n.filter('[data-neo-bts="input.maxBlocks"]'),this.$maxSiblingBlocksInput=n.filter('[data-neo-bts="input.maxSiblingBlocks"]'),this.$maxChildBlocksInput=n.filter('[data-neo-bts="input.maxChildBlocks"]'),this.$maxChildBlocksContainer=n.filter('[data-neo-bts="container.maxChildBlocks"]'),this.$topLevelInput=n.filter('[data-neo-bts="input.topLevel"]'),this.$topLevelContainer=n.filter('[data-neo-bts="container.topLevel"]'),this.$childBlocksInput=n.filter('[data-neo-bts="input.childBlocks"]'),this.$childBlocksContainer=n.filter('[data-neo-bts="container.childBlocks"]'),this.$deleteButton=n.filter('[data-neo-bts="button.delete"]'),s().initUiElements(this.$container),this._childBlocksSelect=this.$childBlocksInput.data("checkboxSelect"),this._topLevelLightswitch=this.$topLevelInput.data("lightswitch"),this._handleGenerator=new(s().HandleGenerator)(this.$nameInput,this.$handleInput),""!==this.getHandle()&&this._handleGenerator.stopListening();var i,o=k(e.childBlockTypes);try{for(o.s();!(i=o.n()).done;){var r=i.value;this.addChildBlockType(r)}}catch(t){o.e(t)}finally{o.f()}this.setChildBlocks(e.childBlocks),a().Base.prototype.on.call(this._topLevelLightswitch,"change",(function(){return t.setTopLevel(t._topLevelLightswitch.on)})),this.addListener(this.$nameInput,"keyup change",(function(){t.setName(t.$nameInput.val()),t._handleGenerator.listening&&t.setHandle(t.$handleInput.val())})),this.addListener(this.$handleInput,"keyup change textchange",(function(){return t.setHandle(t.$handleInput.val())})),this.addListener(this.$maxBlocksInput,"keyup change",(function(){return t.setMaxBlocks(t.$maxBlocksInput.val())})),this.addListener(this.$maxSiblingBlocksInput,"keyup change",(function(){return t.setSiblingMaxBlocks(t.$maxSiblingBlocksInput.val())})),this.addListener(this.$maxChildBlocksInput,"keyup change",(function(){return t.setMaxChildBlocks(t.$maxChildBlocksInput.val())})),this.addListener(this.$deleteButton,"click",(function(){window.confirm(s().t("neo","Are you sure you want to delete this block type?"))&&t.destroy()})),this.$childBlocksInput.on("change","input",(function(){return t._refreshMaxChildBlocks()}))},_generateBlockTypeSettings:function(){var t=this.getErrors(),e=this.getMaxBlocks(),i=this.getMaxSiblingBlocks(),a=this.getMaxChildBlocks();c.enter(this._templateNs);var o=c.fieldName("sortOrder"),r=c.value("name","-"),l=c.fieldName("name"),d=c.value("handle","-"),u=c.fieldName("handle"),h=c.value("maxBlocks","-"),p=c.fieldName("maxBlocks"),f=c.value("maxSiblingBlocks","-"),m=c.fieldName("maxSiblingBlocks"),g=c.value("childBlocks","-"),v=c.fieldName("childBlocks"),y=c.value("maxChildBlocks","-"),b=c.fieldName("maxChildBlocks"),k=c.value("topLevel","-"),B=c.fieldName("topLevel");return c.leave(),n()('\n      <div>\n        <input type="hidden" name="'.concat(o,'" value="').concat(this.getSortOrder(),'" data-neo-bts="input.sortOrder">\n        <div>\n          ').concat(this._input({type:"text",id:r,name:l,label:s().t("neo","Name"),instructions:s().t("neo","What this block type will be called in the CP."),required:!0,value:this.getName(),errors:t.name,attributes:{"data-neo-bts":"input.name"}}),"\n          ").concat(this._input({type:"text",id:d,name:u,label:s().t("neo","Handle"),instructions:s().t("neo","How you&#8217;ll refer to this block type in the templates."),required:!0,class:"code",value:this.getHandle(),errors:t.handle,attributes:{"data-neo-bts":"input.handle"}}),"\n          ").concat(this._input({type:"number",id:h,name:p,label:s().t("neo","Max Blocks"),instructions:s().t("neo","The maximum number of blocks of this type the field is allowed to have."),fullWidth:!1,value:e>0?e:null,errors:t.maxBlocks,attributes:{min:0,style:"width: 80px;","data-neo-bts":"input.maxBlocks"}}),"\n          ").concat(this._input({type:"number",id:f,name:m,label:s().t("neo","Max Sibling Blocks of This Type"),instructions:s().t("neo","The maximum number of blocks of this type allowed under one parent block or at the top level."),fullWidth:!1,value:i>0?i:null,errors:t.maxSiblingBlocks,attributes:{min:0,style:"width: 80px;","data-neo-bts":"input.maxSiblingBlocks"}}),"\n          ").concat(this._field({id:g,label:s().t("neo","Child Blocks"),instructions:s().t("neo","Which block types do you want to allow as children?"),input:'\n              <div class="checkbox-select" data-neo-bts="input.childBlocks">\n                <div>\n                  <input type="hidden" name="'.concat(v,'">\n                  <input type="checkbox" value="*" id="').concat(g,'" class="all checkbox" name="').concat(v,'">\n                  <label for="').concat(g,'"><strong>').concat(s().t("neo","All"),'</strong></label>\n                </div>\n                <div data-neo-bts="container.childBlocks"></div>\n              </div>')}),'\n          <div data-neo-bts="container.maxChildBlocks">\n            ').concat(this._input({type:"number",id:y,name:b,label:s().t("neo","Max Child Blocks"),instructions:s().t("neo","The maximum number of child blocks this block type is allowed to have."),fullWidth:!1,value:a>0?a:null,errors:t.maxChildBlocks,attributes:{min:0,style:"width: 80px;","data-neo-bts":"input.maxChildBlocks"}}),'\n          </div>\n          <div data-neo-bts="container.topLevel">\n            ').concat(this._lightswitch({id:k,name:B,label:s().t("neo","Top Level"),instructions:s().t("neo","Will this block type be allowed at the top level?"),checked:this.getTopLevel(),attributes:{"data-neo-bts":"input.topLevel"}}),'\n          </div>\n        </div>\n        <hr>\n        <a class="error delete" data-neo-bts="button.delete">').concat(s().t("neo","Delete block type"),"</a>\n      </div>"))},_generateChildBlocksCheckbox:function(t){c.enter(this._templateNs);var e=c.value("childBlock-"+t.getId(),"-"),i=c.fieldName("childBlocks");return c.leave(),n()('\n      <div>\n        <input type="checkbox" value="'.concat(t.getHandle(),'" id="').concat(e,'" class="checkbox" name="').concat(i,'[]" data-neo-btsc="input">\n        <label for="').concat(e,'" data-neo-btsc="text.label">').concat(t.getName(),"</label>\n      </div>"))},getFocusInput:function(){return this.$nameInput},getId:function(){return this._id},isNew:function(){return/^new/.test(this.getId())},getErrors:function(){return this._errors},setSortOrder:function(t){this.base(t),this.$sortOrderInput.val(this.getSortOrder())},getName:function(){return this._name},setName:function(t){if(t!==this._name){var e=this._name;this._name=t,this.$nameInput.val()!==this._name&&this.$nameInput.val(this._name),this.trigger("change",{property:"name",oldValue:e,newValue:this._name})}},getHandle:function(){return this._handle},setHandle:function(t){if(t!==this._handle){var e=this._handle;this._handle=t,this.$handleInput.val()!==this._handle&&this.$handleInput.val(this._handle),this.trigger("change",{property:"handle",oldValue:e,newValue:this._handle})}},getMaxBlocks:function(){return this._maxBlocks},setMaxBlocks:function(t){var e=this._maxBlocks,n=Math.max(0,0|t);0===n&&this.$maxBlocksInput.val(null),e!==n&&(this._maxBlocks=n,this._maxBlocks>0&&parseInt(this.$maxBlocksInput.val())!==this._maxBlocks&&this.$maxBlocksInput.val(this._maxBlocks),this.trigger("change",{property:"maxBlocks",oldValue:e,newValue:this._maxBlocks}))},getMaxSiblingBlocks:function(){return this._maxSiblingBlocks},setMaxSiblingBlocks:function(t){var e=this._maxSiblingBlocks,n=Math.max(0,0|t);0===n&&this.$maxSiblingBlocksInput.val(null),e!==n&&(this._maxSiblingBlocks=n,this._maxSiblingBlocks>0&&parseInt(this.$maxSiblingBlocksInput.val())!==this._maxSiblingBlocks&&this.$maxSiblingBlocksInput.val(this._maxSiblingBlocks),this.trigger("change",{property:"maxSiblingBlocks",oldValue:e,newValue:this._maxSiblingBlocks}))},getMaxChildBlocks:function(){return this._maxChildBlocks},setMaxChildBlocks:function(t){var e=this._maxChildBlocks,n=Math.max(0,0|t);0===n&&this.$maxChildBlocksInput.val(null),e!==n&&(this._maxChildBlocks=n,this._maxChildBlocks>0&&parseInt(this.$maxChildBlocksInput.val())!==this._maxChildBlocks&&this.$maxChildBlocksInput.val(this._maxChildBlocks),this.trigger("change",{property:"maxChildBlocks",oldValue:e,newValue:this._maxChildBlocks}))},getTopLevel:function(){return this._topLevel},setTopLevel:function(t){var e=this._topLevel,n=!!t;e!==n&&(this._topLevel=n,this._topLevelLightswitch&&this._topLevelLightswitch.on!==this._topLevel&&(this._topLevelLightswitch.on=this._topLevel,this._topLevelLightswitch.toggle()),this.trigger("change",{property:"topLevel",oldValue:e,newValue:this._topLevel}))},getChildBlocks:function(){var t=this._childBlocksSelect,e=[];return!!t.$all.prop("checked")||(t.$options.each((function(t){var i=n()(this);i.prop("checked")&&e.push(i.val())})),e.length>0&&e)},setChildBlocks:function(t){var e=this._childBlocksSelect;if(!0===t||"*"===t)e.$all.prop("checked",!0),e.onAllChange();else if(Array.isArray(t)){e.$all.prop("checked",!1);var n,i=k(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.$options.filter('[value="'.concat(a,'"]')).prop("checked",!0)}}catch(t){i.e(t)}finally{i.f()}}else e.$all.prop("checked",!1),e.$options.prop("checked",!1);this._refreshMaxChildBlocks(!1)},addChildBlockType:function(t){var e=this;if(!this._childBlockTypes.includes(t)){var n=t.getSettings(),i=this._generateChildBlocksCheckbox(n);this._childBlockTypes.push(t),this.$childBlocksContainer.append(i),this._refreshChildBlocks();var a=this._childBlocksSelect,o=a.$all.prop("checked");a.$options=a.$options.add(i.find("input")),o&&a.onAllChange();var s=".childBlock"+this.getId();n.on("change"+s,(function(n){return e["@onChildBlockTypeChange"](n,t,i)})),n.on("destroy"+s,(function(n){return e.removeChildBlockType(t)}))}},removeChildBlockType:function(t){var e=this._childBlockTypes.indexOf(t);if(e>=0){this._childBlockTypes.splice(e,1);var n=t.getSettings(),i=this.$childBlocksContainer.children().eq(e);i.remove();var a=this._childBlocksSelect;a.$options=a.$options.remove(i.find("input"));var o=".childBlock"+this.getId();n.off(o),this._refreshChildBlocks()}},_refreshChildBlocks:function(){var t=Array.from(this._childBlockTypes),e=this.$childBlocksContainer.children(),n=function(n){return e.get(t.indexOf(n))};this._childBlockTypes=this._childBlockTypes.sort((function(t,e){return t.getSettings().getSortOrder()-e.getSettings().getSortOrder()})),e.remove();var i,a=k(this._childBlockTypes);try{for(a.s();!(i=a.n()).done;){var o=n(i.value);this.$childBlocksContainer.append(o)}}catch(t){a.e(t)}finally{a.f()}},_refreshMaxChildBlocks:function(t){var e=this;t="boolean"!=typeof t||t;var n=!!this.getChildBlocks();t?n?this.$maxChildBlocksContainer.hasClass("hidden")&&this.$maxChildBlocksContainer.removeClass("hidden").css({opacity:0,marginBottom:-this.$maxChildBlocksContainer.outerHeight()}).velocity({opacity:1,marginBottom:24},"fast"):this.$maxChildBlocksContainer.hasClass("hidden")||this.$maxChildBlocksContainer.css({opacity:1,marginBottom:24}).velocity({opacity:0,marginBottom:-this.$maxChildBlocksContainer.outerHeight()},"fast",(function(){e.$maxChildBlocksContainer.addClass("hidden")})):this.$maxChildBlocksContainer.toggleClass("hidden",!n).css("margin-bottom",n?24:"")},"@onChildBlockTypeChange":function(t,e,n){var i=n.find("[data-neo-btsc]"),a=i.filter('[data-neo-btsc="input"]'),o=i.filter('[data-neo-btsc="text.label"]');switch(t.property){case"name":o.text(t.newValue);break;case"handle":a.val(t.newValue);break;case"sortOrder":this._refreshChildBlocks()}}},{_totalNewBlockTypes:0,getNewId:function(){return"new".concat(this._totalNewBlockTypes++)}});function $(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var S={namespace:[],html:"",layout:null,id:-1,blockId:null,blockName:""};const w=a().Base.extend({_templateNs:[],_blockName:"",init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},S,e),this._templateNs=c.parse(e.namespace),this._id=0|e.id,this._blockTypeId=e.blockTypeId,this.setBlockName(e.blockName),this.$container=n()(e.html).find(".layoutdesigner"),this.$container.removeAttr("id");var i=this.$container.find('input[name="fieldLayout"]');i.length>0&&(i[0].name="neoBlockType".concat(this._blockTypeId,"[fieldLayout]"),e.layout&&(i[0].value=JSON.stringify(e.layout))),c.enter(this._templateNs),this._fld=new(s().FieldLayoutDesigner)(this.$container,{customizableTabs:!0,customizableUi:!0}),c.leave(),this._tabObserver=new window.MutationObserver((function(){var e="[data-type=benf\\\\neo\\\\fieldlayoutelements\\\\ChildBlocksUiElement]",i=t._fld.$uiLibraryElements.filter(e),a=t._fld.$tabContainer.find(e);i.toggleClass("hidden",a.length>0||n()("body.dragging .draghelper"+e).length>0),a.hasClass("velocity-animating")&&a.removeClass("hidden")}))},getId:function(){return this._id},getBlockTypeId:function(){return this._blockTypeId},getBlockName:function(){return this._blockName},setBlockName:function(t){this._blockName=t},getConfig:function(){var t,e={tabs:[]},n=$(this._fld.config.tabs);try{for(n.s();!(t=n.n()).done;){var i,a=t.value,o=[],s=$(a.elements);try{for(s.s();!(i=s.n()).done;){var r=i.value,l={};for(var c in r)l[c]=r[c];o.push(l)}}catch(t){s.e(t)}finally{s.f()}e.tabs.push({elements:o,name:a.name.slice()})}}catch(t){n.e(t)}finally{n.f()}return e}});var I={namespace:[]};const T=u.extend({_templateNs:[],init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.base(e),e=Object.assign({},I,e);var n=this.getSettings();this._templateNs=c.parse(e.namespace),this.$container=this._generateGroup(n);var i=this.$container.find("[data-neo-g]");this.$nameText=i.filter('[data-neo-g="text.name"]'),this.$moveButton=i.filter('[data-neo-g="button.move"]'),n&&(n.on("change",(function(){return t._updateTemplate()})),n.on("destroy",(function(){return t.trigger("destroy")}))),this.deselect()},_generateGroup:function(t){return n()('\n      <div class="nc_sidebar_list_item type-heading">\n        <div class="label" data-neo-g="text.name">'.concat(t.getName(),'</div>\n        <a class="move icon" title="').concat(s().t("neo","Reorder"),'" role="button" data-neo-g="button.move"></a>\n      </div>'))},toggleSelect:function(t){this.base(t);var e=this.getSettings(),n=this.isSelected();e&&e.$container.toggleClass("hidden",!n),this.$container.toggleClass("is-selected",n)},_updateTemplate:function(){var t=this.getSettings();t&&this.$nameText.text(t.getName())}});var L={namespace:[],id:null,sortOrder:0,name:""};const N=b.extend({_templateNs:[],$sortOrderInput:new(n()),$nameInput:new(n()),$handleInput:new(n()),$maxBlocksInput:new(n()),init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},L,e),this._templateNs=c.parse(e.namespace),this._id=e.id,this.setSortOrder(e.sortOrder),this.setName(e.name),this.$container=this._generateGroupSettings();var n=this.$container.find("[data-neo-gs]");this.$sortOrderInput=n.filter('[data-neo-gs="input.sortOrder"]'),this.$nameInput=n.filter('[data-neo-gs="input.name"]'),this.$deleteButton=n.filter('[data-neo-gs="button.delete"]'),this.addListener(this.$nameInput,"keyup change",(function(){return t.setName(t.$nameInput.val())})),this.addListener(this.$deleteButton,"click",(function(){window.confirm(s().t("neo","Are you sure you want to delete this group?"))&&t.destroy()}))},_generateGroupSettings:function(){c.enter(this._templateNs);var t=c.fieldName("sortOrder"),e=c.value("name","-"),i=c.fieldName("name");return c.leave(),n()('\n      <div>\n      <input type="hidden" name="'.concat(t,'" value="').concat(this.getSortOrder(),'" data-neo-gs="input.sortOrder">\n      <div>\n        ').concat(this._input({type:"text",id:e,name:i,label:s().t("neo","Name"),instructions:s().t("neo","This can be left blank if you just want an unlabeled separator."),value:this.getName(),attributes:{"data-neo-gs":"input.name"}}),'\n      </div>\n      <hr>\n      <a class="error delete" data-neo-gs="button.delete">').concat(s().t("neo","Delete group"),"</a>\n    </div>"))},getFocusInput:function(){return this.$nameInput},getId:function(){return this._id},setSortOrder:function(t){this.base(t),this.$sortOrderInput.val(this.getSortOrder())},getName:function(){return this._name},setName:function(t){if(t!==this._name){var e=this._name;this._name=t,this.$nameInput.val(this._name),this.trigger("change",{property:"name",oldValue:e,newValue:this._name})}}},{_totalNewGroups:0,getNewId:function(){return"new".concat(this._totalNewGroups++)}});function O(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=M(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){r=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(r)throw o}}}}function A(t){return function(t){if(Array.isArray(t))return j(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||M(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){if(t){if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(t,e):void 0}}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var F={namespace:[],blockTypes:[],groups:[],fieldLayoutHtml:""};const H=a().Base.extend({_templateNs:[],_items:[],init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},F,e);var i=s().formatInputId(e.namespace),o=n()("#".concat(i,"-neo-configurator")),r=o.children(".field").children(".input");this._templateNs=c.parse(e.namespace),this._fieldLayoutHtml=e.fieldLayoutHtml,this._items=[],this.$container=this._generateConfigurator(),r.append(this.$container);var l=this.$container.find("[data-neo]");this.$mainContainer=l.filter('[data-neo="container.main"]'),this.$sidebarContainer=l.filter('[data-neo="container.sidebar"]'),this.$blockTypesContainer=l.filter('[data-neo="container.blockTypes"]'),this.$settingsContainer=l.filter('[data-neo="container.settings"]'),this.$fieldLayoutContainer=l.filter('[data-neo="container.fieldLayout"]'),this.$blockTypeButton=l.filter('[data-neo="button.blockType"]'),this.$groupButton=l.filter('[data-neo="button.group"]'),this.$settingsButton=l.filter('[data-neo="button.settings"]'),this.$fieldLayoutButton=l.filter('[data-neo="button.fieldLayout"]'),this._itemSort=new(a().DragSort)(null,{container:this.$blockTypeItemsContainer,handle:'[data-neo-bt="button.move"], [data-neo-g="button.move"]',axis:"y",onSortChange:function(){return t._updateItemOrder()}});var d,u=[],h=[].concat(A(this._templateNs),["blockTypes"]),f=[].concat(A(this._templateNs),["groups"]),m=O(e.blockTypes);try{var g=function(){var e=d.value,n=new x({namespace:[].concat(A(h),[e.id]),sortOrder:e.sortOrder,id:e.id,name:e.name,handle:e.handle,maxBlocks:e.maxBlocks,maxSiblingBlocks:e.maxSiblingBlocks,maxChildBlocks:e.maxChildBlocks,topLevel:e.topLevel,errors:e.errors,childBlockTypes:u.filter((function(t){return t instanceof p}))}),i=new w({namespace:[].concat(A(h),[e.id]),html:e.fieldLayoutHtml,id:e.fieldLayoutId,blockTypeId:e.id}),a=new p({namespace:h,settings:n,fieldLayout:i});window.localStorage.getItem("neo:copyBlockType")&&a.$actionsMenu.find('[data-action="paste"]').parent().removeClass("disabled"),a.on("copy.configurator",(function(){return t._copyBlockType(a)})),a.on("paste.configurator",(function(){return t._pasteBlockType()})),a.on("clone.configurator",(function(){return t._createBlockTypeFrom(a)})),u.push(a)};for(m.s();!(d=m.n()).done;)g()}catch(t){m.e(t)}finally{m.f()}var v,y=O(e.groups);try{for(y.s();!(v=y.n()).done;){var b=v.value,k=new N({namespace:[].concat(A(f),[b.id]),sortOrder:b.sortOrder,id:b.id,name:b.name}),B=new T({namespace:f,settings:k});u.push(B)}}catch(t){y.e(t)}finally{y.f()}var _,$=O(u.sort((function(t,e){return t.getSettings().getSortOrder()-e.getSettings().getSortOrder()})));try{for($.s();!(_=$.n()).done;){var C=_.value;this.addItem(C)}}catch(t){$.e(t)}finally{$.f()}var S,I=O(this.getBlockTypes());try{var L=function(){var t=S.value.getSettings(),n=e.blockTypes.find((function(e){return e.handle===t.getHandle()}));t.setChildBlocks(n.childBlocks)};for(I.s();!(S=I.n()).done;)L()}catch(t){I.e(t)}finally{I.f()}this.selectTab("settings"),this.addListener(this.$blockTypeButton,"click","@newBlockType"),this.addListener(this.$groupButton,"click","@newGroup"),this.addListener(this.$settingsButton,"click",(function(){return t.selectTab("settings")})),this.addListener(this.$fieldLayoutButton,"click",(function(){return t.selectTab("fieldLayout")}))},_generateConfigurator:function(){return n()('\n      <div class="nc_sidebar" data-neo="container.sidebar">\n        <div class="nc_sidebar_title">'.concat(s().t("neo","Block Types"),'</div>\n        <div class="nc_sidebar_list" data-neo="container.blockTypes"></div>\n        <div class="nc_sidebar_buttons btngroup">\n          <a class="btn add icon" role="button" data-neo="button.blockType">').concat(s().t("neo","Block type"),'</a>\n          <a class="btn type-heading" role="button" data-neo="button.group">').concat(s().t("neo","Group"),'</a>\n        </div>\n      </div>\n      <div class="nc_main" data-neo="container.main">\n        <div class="nc_main_tabs">\n          <a class="nc_main_tabs_tab is-selected" role="button" data-neo="button.settings">').concat(s().t("neo","Settings"),'</a>\n          <a class="nc_main_tabs_tab" role="button" data-neo="button.fieldLayout">').concat(s().t("neo","Field Layout"),'</a>\n        </div>\n        <div class="nc_main_content" data-neo="container.settings"></div>\n        <div class="nc_main_content" data-neo="container.fieldLayout"></div>\n      </div>'))},addItem:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=t.getSettings();if(this._insertAt(t.$container,n),this._itemSort.addItems(t.$container),i&&this.$settingsContainer.append(i.$container),this.$mainContainer.removeClass("hidden"),this.addListener(t.$container,"click","@selectItem"),t.on("destroy.configurator",(function(){return e.removeItem(t,!1)})),t instanceof p){var a=t.getFieldLayout();a&&this.$fieldLayoutContainer.append(a.$container)}if(this._items.push(t),this._updateItemOrder(),t instanceof p){var o,s=O(this.getBlockTypes());try{for(s.s();!(o=s.n()).done;){var r=o.value,l=r.getSettings();l&&l.addChildBlockType(t)}}catch(t){s.e(t)}finally{s.f()}}this.trigger("addItem",{item:t,index:n})},removeItem:function(t,e){if(e="boolean"==typeof e&&e){var n=s().t("neo","Are you sure you want to delete this {type}?",{type:t instanceof p?"block type":t instanceof T?"group":"item"});window.confirm(n)&&this.removeItem(t,!1)}else{var i=t.getSettings();if(this._itemSort.removeItems(t.$container),t.$container.remove(),i&&i.$container.remove(),t instanceof p){var a=t.getFieldLayout();a&&a.$container.remove()}this.removeListener(t.$container,"click"),t.off(".configurator"),this._updateItemOrder(),0===this._items.length&&this.$mainContainer.addClass("hidden"),this.trigger("removeItem",{item:t})}},getItems:function(){return Array.from(this._items)},getItemByElement:function(t){return this._items.find((function(e){return e.$container.is(t)}))},getSelectedItem:function(){return this._items.find((function(t){return t.isSelected()}))},selectItem:function(t,e){e="boolean"!=typeof e||e;var n,i=t?t.getSettings():null,o=O(this._items);try{for(o.s();!(n=o.n()).done;){var s=n.value,r=s===t;s.toggleSelect(r),r&&this.toggleFieldLayoutTabVisibility(s instanceof p)}}catch(t){o.e(t)}finally{o.f()}e&&i&&!a().isMobileBrowser()&&setTimeout((function(){return i.getFocusInput().focus()}),100)},getBlockTypes:function(){return this._items.filter((function(t){return t instanceof p}))},getGroups:function(){return this._items.filter((function(t){return t instanceof T}))},selectTab:function(t){this.$settingsContainer.toggleClass("hidden","settings"!==t),this.$fieldLayoutContainer.toggleClass("hidden","fieldLayout"!==t),this.$settingsButton.toggleClass("is-selected","settings"===t),this.$fieldLayoutButton.toggleClass("is-selected","fieldLayout"===t)},toggleFieldLayoutTabVisibility:function(t){t||this.selectTab("settings"),this.$fieldLayoutButton.toggleClass("hidden",!t)},_updateItemOrder:function(){var t=this,e=[];this._itemSort.$items.each((function(n,i){var a=t.getItemByElement(i);if(a){var o=a.getSettings();o&&o.setSortOrder(n+1),e.push(a)}})),this._items=e},_createBlockTypeFrom:function(t){var e=this,i=[].concat(A(this._templateNs),["blockTypes"]),a=x.getNewId(),o=this.getSelectedItem(),r=o?o.getSettings().getSortOrder():-1;if(null===t){var l=new x({childBlockTypes:this.getBlockTypes(),id:a,namespace:[].concat(A(i),[a]),sortOrder:this._items.length}),c=new w({blockTypeId:a,html:this._fieldLayoutHtml,namespace:[].concat(A(i),[a])});this._initBlockType(i,l,c,r)}else{var d=t.getSettings(),u=new x({childBlocks:d.getChildBlocks(),childBlockTypes:this.getBlockTypes(),handle:"".concat(d.getHandle(),"_").concat(Date.now()),id:a,maxBlocks:d.getMaxBlocks(),maxChildBlocks:d.getMaxChildBlocks(),maxSiblingBlocks:d.getMaxSiblingBlocks(),name:d.getName(),namespace:[].concat(A(i),[a]),sortOrder:this._items.length,topLevel:d.getTopLevel()}),h=t.getFieldLayout().getConfig();if(h.tabs.length>0){var p=n()('<div class="nc_sidebar_list_item type-spinner"><span class="spinner"></span></div>');this._insertAt(p,r),s().postActionRequest("neo/configurator/render-field-layout",{layout:h},(function(t){var n=new w({blockTypeId:a,html:t.success?t.html:e._fieldLayoutHtml,namespace:[].concat(A(i),[a])});e.$blockTypesContainer.find(".type-spinner").remove(),e._initBlockType(i,u,n,r)}))}else{var f=new w({blockTypeId:a,html:this._fieldLayoutHtml,namespace:[].concat(A(i),[a])});this._initBlockType(i,u,f,r)}}},_initBlockType:function(t,e,n,i){var a=this,o=new p({namespace:t,settings:e,fieldLayout:n});this.addItem(o,i),this.selectItem(o),o.on("copy.configurator",(function(){return a._copyBlockType(o)})),o.on("paste.configurator",(function(){return a._pasteBlockType()})),o.on("clone.configurator",(function(){return a._createBlockTypeFrom(o)}))},_copyBlockType:function(t){var e=t.getSettings(),n={childBlocks:e.getChildBlocks(),handle:e.getHandle(),layout:t.getFieldLayout().getConfig(),maxBlocks:e.getMaxBlocks(),maxChildBlocks:e.getMaxChildBlocks(),maxSiblingBlocks:e.getMaxSiblingBlocks(),name:e.getName(),topLevel:e.getTopLevel()};window.localStorage.setItem("neo:copyBlockType",JSON.stringify(n)),this.getBlockTypes().forEach((function(t){return t.$actionsMenu.find('[data-action="paste"]').parent().removeClass("disabled")}))},_pasteBlockType:function(){var t=window.localStorage.getItem("neo:copyBlockType");if(t){var e=JSON.parse(t),n=this.getBlockTypes().map((function(t){return t.getSettings().getHandle()})),i=Array.isArray(e.childBlocks)?e.childBlocks.filter((function(t){return n.includes(t)})):!!e.childBlocks||[],a=new x({childBlocks:i,childBlockTypes:this.getBlockTypes(),handle:e.handle,maxBlocks:e.maxBlocks,maxChildBlocks:e.maxChildBlocks,maxSiblingBlocks:e.maxSiblingBlocks,name:e.name,topLevel:e.topLevel}),o=new w({html:this._fieldLayoutHtml,layout:e.layout}),s=new p({settings:a,fieldLayout:o});this._createBlockTypeFrom(s)}},_insertAt:function(t,e){var i=n()(t);e>=0&&e<this._items.length?i.insertAt(e,this.$blockTypesContainer):this.$blockTypesContainer.append(i)},"@newBlockType":function(){this._createBlockTypeFrom(null)},"@newGroup":function(){var t=[].concat(A(this._templateNs),["groups"]),e=N.getNewId(),n=new N({namespace:[].concat(A(t),[e]),sortOrder:this._items.length,id:e}),i=new T({namespace:t,settings:n}),a=this.getSelectedItem(),o=a?a.getSettings().getSortOrder():-1;this.addItem(i,o),this.selectItem(i)},"@selectItem":function(t){var e=this.getItemByElement(t.currentTarget);this.selectItem(e)}});var V="undefined"!=typeof window?window:void 0,E=[];V.Neo={Configurator:H,configurators:E,createConfigurator:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new H(t);return E.push(e),e}}})();
(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=jQuery;var n=t.n(e);n().fn.insertAt=function(t,e){return this.each((function(){0===t?e.prepend(this):e.children().eq(t-1).after(this)}))};const i=Garnish;var o=t.n(i);const a=Craft;var r=t.n(a);function s(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}const c={_stack:[[]],enter:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("string"==typeof t&&(t=this.fromFieldName(t)),e){var n=this.getNamespace();n.push.apply(n,s(t)),t=n}this._stack.push(t)},enterByFieldName:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.enter(this.fromFieldName(t),e)},leave:function(){return this._stack.length>1?this._stack.pop():this.getNamespace()},getNamespace:function(){return Array.from(this._stack[this._stack.length-1])},parse:function(t){return"string"==typeof t?t.indexOf("[")>-1?this.fromFieldName(t):t.indexOf("-")>-1?t.split("-"):t.indexOf(".")>-1?t.split("."):t:Array.from(t)},value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"-",n=this.getNamespace();return n.push(t),n.join(e)},fieldName:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=this.toFieldName();return e?e+t.replace(/([^'"[\]]+)([^'"]*)/,"[$1]$2"):t},toString:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-";return this.getNamespace().join(t)},toFieldName:function(){var t=this.getNamespace();switch(t.length){case 0:return"";case 1:return t[0]}return t[0]+"["+t.slice(1).join("][")+"]"},fromFieldName:function(t){return t.match(/[^[\]\s]+/g)||[]}};function d(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function u(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=f(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw a}}}}function f(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var g=o().Drag.extend({$container:null,blocks:null,maxTopBlocks:0,_draggeeBlocks:null,init:function(t,e){void 0===e&&n().isPlainObject(t)&&(e=t,t=null),(e=n().extend({},g.defaults,e)).axis=o().Y_AXIS,this.base(t,e),this.$container=e.container,this.blocks=[],this.maxTopBlocks=e.maxTopBlocks},getHelperTargetX:function(){return this.$draggee.offset().left},getHelperTargetY:function(){var t=this.settings.magnetStrength;if(1!==t){var e=this.$draggee.offset().top;return e+(this.mouseY-this.mouseOffsetY-e)/t}return this.base()},getBlockByElement:function(t){return this.blocks.find((function(e){return e.$container.is(t)}))},getParentBlock:function(t){var e=t.$container.parent().closest(".ni_block");return e.length>0&&this.getBlockByElement(e)},onDragStart:function(){var t=this;this._draggeeBlocks=[],this.$draggee.each((function(){t._draggeeBlocks.push(t.getBlockByElement(this))})),this.base(),this._calculateMidpoints()},onDrag:function(){var t=this._getClosestMidpoint();t&&this._moveDraggeeToBlock(t.block,t.type,t.direction),this.base()},onDragStop:function(){var t=this;this.$draggee.each((function(){var e=n()(this),i=t.getBlockByElement(e);if(e.parent().is(t.$container))i.setLevel(1);else{var o=t.getParentBlock(i);i.setLevel(o.getLevel()+1)}e.find(".ni_block").each((function(){var e=n()(this),i=t.getBlockByElement(e),o=t.getParentBlock(i);i.setLevel(o.getLevel()+1)}))})),this.returnHelpersToDraggees(),this.base()},addBlock:function(t){this.blocks.push(t),this.addItems(t.$container)},removeBlock:function(t){this.blocks=this.blocks.filter((function(e){return e!==t})),this.removeItems(t.$container)},_getClosestMidpoint:function(){var t,e=Number.MAX_VALUE,n=Number.MIN_VALUE,i=null,o=u(this._currentMidpoints);try{for(o.s();!(t=o.n()).done;){var a=t.value;if(a.direction===g.DIRECTION_UP)this.mouseY-this.mouseOffsetY<a.position&&a.position<e&&(e=a.position,i=a);else this.mouseY-this.mouseOffsetY+this._draggeeBlockHeight>a.position&&a.position>n&&(n=a.position,i=a)}}catch(t){o.e(t)}finally{o.f()}return i},_calculateMidpoints:function(){this._draggeeBlockY=this.$draggee.offset().top,this._draggeeBlockHeight=this.$draggee.height()+10,this._currentMidpoints=[];var t,e=u(this.blocks);try{for(e.s();!(t=e.n()).done;){var n=t.value;if(0===n.$container.closest(this.$draggee).length)for(var i=this._getBlockMidpoints(n),o=0,a=Object.keys(i);o<a.length;o++){var r=a[o],s=i[r],l=this._draggeeBlockY>s?g.DIRECTION_UP:g.DIRECTION_DOWN;this._currentMidpoints.push({block:n,position:s,type:r,direction:l})}}}catch(t){e.e(t)}finally{e.f()}var c=this.$container.offset().top+this.$container.height()+5;this._currentMidpoints.push({block:null,position:c,type:g.TYPE_END,direction:g.DIRECTION_DOWN})},_getBlockMidpoints:function(t){var e={};if(!(t.$container.parent().closest(".ni_block.is-collapsed").length>0)){var n=t.$container.offset().top,i=t.isExpanded(),o=t.$container.height(),a=t.$topbarContainer.height(),r=i?t.$childrenContainer.height():0,s=i&&t.$contentContainer.length>0?t.$childrenContainer.length>0?t.$childrenContainer.offset().top-t.$contentContainer.offset().top:t.$contentContainer.height():0,l=this.getParentBlock(t);if(l&&!this._validateDraggeeChildren(l)||(e[g.TYPE_CONTENT]=n+(a+s)/2),r>0&&t.isExpanded()&&this._validateDraggeeChildren(t)){var c=t.getButtons().$container.height();e[g.TYPE_CHILDREN]=n+o-1-(14+c+10)/2}}return e},_moveDraggeeToBlock:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.TYPE_CONTENT,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.DIRECTION_DOWN,i=t?this.getParentBlock(t):null,o=this._validateDraggeeChildren(i);switch(e){case g.TYPE_CHILDREN:0===this.$draggee.closest(t.$container).length?t.$blocksContainer.append(this.$draggee):o&&t.$container.after(this.$draggee);break;case g.TYPE_END:o&&this.$container.append(this.$draggee);break;default:n===g.DIRECTION_UP?o&&t.$container.before(this.$draggee):t.getBlockType().isParent()&&t.isExpanded()&&this._validateDraggeeChildren(t)?t.$blocksContainer.prepend(this.$draggee):o&&t.$container.after(this.$draggee)}this._updateHelperAppearance(),this._calculateMidpoints()},_validateDraggeeChildren:function(t){var e=this,n=t?t.getField():this._draggeeBlocks[0].getField(),i=n.getMaxLevels();if(i>0){var o=t?t.getLevel():-1,a=this._draggeeBlocks[0].getLevel();if(this._draggeeBlocks.filter((function t(e){var r=e.getChildren(n.getBlocks(),!0);return function(t){return t.getLevel()-a+o+1>=i}(e)||r.some(t)})).length>0)return!1}if(!t){var r,s=this,l=this.$container.children(".ni_block:not(.is-disabled)"),c=l.length,f=u(this._draggeeBlocks);try{for(f.s();!(r=f.n()).done;){if(!r.value.getBlockType().getTopLevel())return!1}}catch(t){f.e(t)}finally{f.f()}return l.each((function(){s._draggeeBlocks.includes(s.getBlockByElement(this))&&c--})),!(this.maxTopBlocks>0&&c>=this.maxTopBlocks)}var p=t.getBlockType(),g=p.getMaxChildBlocks(),b=t.$childrenContainer.children(".ni_blocks").children(".ni_block"),v=b.length,k=[],m=this;if(b.each((function(){var t=m.getBlockByElement(this);m._draggeeBlocks.includes(t)?v--:k.push(t)})),g>0&&v>=g)return!1;var _,y=[],B=u(this._draggeeBlocks);try{var C=function(){var t=_.value;if(!p.isValidChildBlock(t))return{v:!1};if(y.includes(t))return"continue";var n=t.getBlockType(),i=n.getMaxSiblingBlocks();if(0===i)return"continue";var o=e._draggeeBlocks.filter((function(t){return t.getBlockType().getHandle()===n.getHandle()}));if(k.filter((function(t){return t.getBlockType().getHandle()===n.getHandle()})).length+o.length>i)return{v:!1};y.push.apply(y,d(o))};for(B.s();!(_=B.n()).done;){var x=C();if("continue"!==x&&"object"===h(x))return x.v}}catch(t){B.e(t)}finally{B.f()}return!0},_updateHelperAppearance:function(){var t,e=this,n=u(this.helpers);try{var i=function(){var n=t.value,i=n.data("neo-b-id"),o=e.blocks.find((function(t){return t.$container.data("neo-b-id")===i}));n.css({width:o.$container.width()+1,height:o.$container.height()})};for(n.s();!(t=n.n()).done;)i()}catch(t){n.e(t)}finally{n.f()}}},{TYPE_CONTENT:"content",TYPE_CHILDREN:"children",TYPE_END:"end",DIRECTION_UP:"up",DIRECTION_DOWN:"down",defaults:{container:null,magnetStrength:1}});const b=g;var v={name:"",errors:[]};const k=o().Base.extend({init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},v,t),this._name=t.name,this._errors=t.errors},getErrors:function(){return Array.from(this._errors)},getName:function(){return this._name}});var m={id:-1,fieldLayoutId:-1,sortOrder:0,name:"",handle:"",maxBlocks:0,maxSiblingBlocks:0,maxChildBlocks:0,childBlocks:!1,topLevel:!0,tabs:[],hasChildBlocksUiElement:!1};const _=o().Base.extend({init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},m,t),this._id=0|t.id,this._fieldLayoutId=0|t.fieldLayoutId,this._sortOrder=0|t.sortOrder,this._name=t.name,this._handle=t.handle,this._maxBlocks=0|t.maxBlocks,this._maxSiblingBlocks=0|t.maxSiblingBlocks,this._maxChildBlocks=0|t.maxChildBlocks,this._childBlocks=t.childBlocks,this._topLevel=t.topLevel,this._tabs=void 0!==t.tabs.tabNames?t.tabs.tabNames.map((function(t){return t instanceof k?t:new k({name:t})})):[],this._html=void 0!==t.tabs.html?t.tabs.html:"",this._js=void 0!==t.tabs.js?t.tabs.js:"",this._hasChildBlocksUiElement=t.hasChildBlocksUiElement},getType:function(){return"blockType"},getId:function(){return this._id},getFieldLayoutId:function(){return this._fieldLayoutId},getSortOrder:function(){return this._sortOrder},getName:function(){return this._name},getHandle:function(){return this._handle},getMaxBlocks:function(){return this._maxBlocks},getMaxSiblingBlocks:function(){return this._maxSiblingBlocks},getMaxChildBlocks:function(){return this._maxChildBlocks},getChildBlocks:function(){return this._childBlocks},getTopLevel:function(){return this._topLevel},getTabs:function(){return Array.from(this._tabs)},getHtml:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._replaceBlockIdPlaceholder(this._html,t)},getJs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._replaceBlockIdPlaceholder(this._js,t)},_replaceBlockIdPlaceholder:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==e?t.replace(/__NEOBLOCK__/g,e):t},getChildBlockItems:function(t){var e=this,n=t.filter((function(t){return"group"===t.getType()||e.hasChildBlock(t.getHandle())}));return n.filter((function(t,e){if("group"===t.getType()){var i=n[e+1];return i&&"group"!==i.getType()}return!0}))},isParent:function(){var t=this.getChildBlocks();return!0===t||"*"===t||Array.isArray(t)&&t.length>0},hasChildBlock:function(t){var e=this.getChildBlocks();return!0===e||"*"===e||Array.isArray(e)&&e.includes(t)},isValidChildBlock:function(t){return this.hasChildBlock(t.getBlockType().getHandle())},hasChildBlocksUiElement:function(){return this._hasChildBlocksUiElement}});var y={id:-1,sortOrder:0,alwaysShowDropdown:null,name:""};const B=o().Base.extend({init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=Object.assign({},y,t),this._id=0|t.id,this._sortOrder=0|t.sortOrder,this._alwaysShowDropdown=t.alwaysShowDropdown,this._name=t.name},getType:function(){return"group"},getId:function(){return this._id},getSortOrder:function(){return this._sortOrder},getName:function(){return this._name},getAlwaysShowDropdown:function(){return this._alwaysShowDropdown},isBlank:function(){return!this._name}});function C(t){r().CpFieldInspectPlugin&&r().CpFieldInspectPlugin.addFieldLinks()}function x(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw a}}}}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var w={namespace:[],blockType:null,id:null,level:1,buttons:null,enabled:!0,collapsed:!1,modified:!0,showButtons:!0},T={},I={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function E(){var t=this.href||this.src;if(t){var e=t.indexOf("?");t=e<0?t:t.substr(0,e);var n=!Object.prototype.hasOwnProperty.call(T,t);return T[t]=1,n}return!0}function S(t){return t?t.replace(/[&<>"'/]/g,(function(t){return I[t]})):""}function O(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40;return(t=t||"").length>e?t.slice(0,e-3)+"...":t}const M=o().Base.extend({_templateNs:[],_field:null,_blockType:null,_initialised:!1,_expanded:!0,_enabled:!0,_modified:!0,_initialState:null,_forceModified:!1,init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=Object.assign({},w,e),this._templateNs=c.parse(e.namespace),this._field=e.field,this._blockType=e.blockType,this._id=e.id,this._buttons=e.buttons,this._modified=e.modified,this._showButtons=e.showButtons,this._renderOldChildBlocksContainer=!e.blockType.hasChildBlocksUiElement(),this.$container=i?this._generateElement():n()("[data-neo-b-id=".concat(this._id,"]"));var o=this.$container.find("[data-neo-b]");this.$bodyContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.body"]')),this.$contentContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.content"]')),this.$childrenContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.children"]')),this.$childrenWarningsContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.childrenWarnings"]')),this.$collapsedChildrenContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.collapsedChildren"]')),this.$blocksContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.blocks"]')),this.$buttonsContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.buttons"]')),this.$topbarContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.topbar"]')),this.$topbarLeftContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.topbarLeft"]')),this.$topbarRightContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.topbarRight"]')),this.$tabsContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.tabs"]')),this.$tabContainer=this.$contentContainer.children("[data-layout-tab]"),this.$menuContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.menu"]')),this.$previewContainer=o.filter('[data-neo-b="'.concat(this._id,'.container.preview"]')),this.$tabButton=o.filter('[data-neo-b="'.concat(this._id,'.button.tab"]')),this.$settingsButton=o.filter('[data-neo-b="'.concat(this._id,'.button.actions"]')),this.$togglerButton=o.filter('[data-neo-b="'.concat(this._id,'.button.toggler"]')),this.$tabsButton=o.filter('[data-neo-b="'.concat(this._id,'.button.tabs"]')),this.$enabledInput=o.filter('[data-neo-b="'.concat(this._id,'.input.enabled"]')),this.$levelInput=o.filter('[data-neo-b="'.concat(this._id,'.input.level"]')),this.$status=o.filter('[data-neo-b="'.concat(this._id,'.status"]')),this.$sortOrder=o.filter('[data-neo-b="'.concat(this._id,'.sortOrder"]')),this._buttons&&(this._buttons.on("newBlock",(function(e){return t.trigger("newBlock",Object.assign(e,{level:t.getLevel()+1}))})),this.$buttonsContainer.append(this._buttons.$container));var a=!1;if(this._blockType){var r,s=x(this._blockType.getTabs());try{for(s.s();!(r=s.n()).done;){var l=r.value,d='[data-neo-b-info="'.concat(l.getName(),'"]');this.$tabContainer.filter(d).find("ul.errors").length>0&&(a=!0,this.$tabButton.filter(d).addClass("error"))}}catch(t){s.e(t)}finally{s.f()}}this.setLevel(e.level),this.toggleEnabled(e.enabled),this.toggleExpansion(!!a||!e.collapsed,!1,!1),this.toggleShowButtons(this._showButtons),this.addListener(this.$topbarContainer,"dblclick","@doubleClickTitle"),this.addListener(this.$tabButton,"click","@setTab")},_generateElement:function(){c.enter(this._templateNs);var t=c.toFieldName();c.leave();var e=this._blockType,i=e.getTabs(),o=i.length>0,a=e.isParent(),s="".concat(e.getName()," ").concat(r().t("neo","Actions")),l="neoblock-action-menu-".concat(this._id),d=[];if(d.push('\n      <div class="ni_block ni_block--'.concat(e.getHandle()," is-").concat(this._collapsed?"collapsed":"expanded"," ").concat(o||a?"":"is-empty"," ").concat(a?"is-parent":"",'" data-neo-b-id="').concat(this._id,'">\n        <input type="hidden" name="').concat(t,'[type]" value="').concat(e.getHandle(),'">\n        <input type="hidden" name="').concat(t,'[enabled]" value="').concat(this._enabled?"1":"0",'" data-neo-b="').concat(this._id,'.input.enabled">\n        <input type="hidden" name="').concat(t,'[level]" value="').concat(this._level,'" data-neo-b="').concat(this._id,'.input.level">\n        <input type="hidden" name="').concat(this._templateNs[0],"[").concat(this._templateNs[1],'][sortOrder][]" value="').concat(this._id,'" data-neo-b="').concat(this._id,'.input.sortOrder">\n\n        <div class="ni_block_topbar" data-neo-b="').concat(this._id,'.container.topbar">\n          <div class="ni_block_topbar_left" data-neo-b="').concat(this._id,'.container.topbarLeft">\n            <div class="ni_block_topbar_item" data-neo-b="').concat(this._id,'.select">\n              <div class="checkbox block-checkbox" title="').concat(r().t("neo","Select"),' aria-label="').concat(r().t("neo","Select"),'"></div>\n            </div>\n            <div class="ni_block_topbar_item title clip-text">\n              <span class="blocktype" data-neo-b="').concat(this._id,'.select">').concat(e.getName(),'</span><span class="preview" data-neo-b="').concat(this._id,'.container.preview">&nbsp;</span>\n            </div>\n          </div>\n          <div class="ni_block_topbar_right" data-neo-b="').concat(this._id,'.container.topbarRight">\n            <div class="ni_block_topbar_item size-full tabs">')),(o||a)&&d.push('\n              <div class="tabs_trigger" data-neo-b="'.concat(this._id,'.button.toggler"></div>')),i.length>1){d.push('\n              <div class="tabs_inner" data-neo-b="'.concat(this._id,'.container.tabs">'));for(var h=0;h<i.length;h++){var u=i[h].getName();d.push('\n                <a class="tab '.concat(h?"":"is-selected",'" data-neo-b="').concat(this._id,'.button.tab" data-neo-b-info="').concat(u,'">').concat(u,"</a>"))}d.push('\n              </div>\n              <div class="tabs_btn menubtn" data-neo-b="'.concat(this._id,'.button.tabs">\n                ').concat(i[0].getName(),'\n              </div>\n              <div class="neo_block_tabs-menu menu">\n                <ul>'));for(var f=0;f<i.length;f++){var p=i[f].getName();d.push("\n                  <li>\n                    <a".concat(f?"":' class="is-selected"',' data-neo-b="').concat(this._id,'.button.tab" data-neo-b-info="').concat(p,'">').concat(p,"</a>\n                  </li>"))}d.push("\n                </ul>\n              </div>")}return d.push('\n            </div>\n            <div class="ni_block_topbar_item hidden" data-neo-b="'.concat(this._id,'.status">\n              <div class="status off" title="').concat(r().t("neo","Disabled"),'"></div>\n            </div>\n            <div class="ni_block_topbar_item block-settings">\n              <div>\n                <button class="btn settings icon menubtn" type="button" role="button" title="').concat(r().t("neo","Actions"),'" aria-controls="').concat(l,'" aria-label="').concat(s,'" data-disclosure-trigger data-neo-b="').concat(this._id,'.button.actions"></button>\n                <div id="').concat(l,'" class="menu menu--disclosure" data-neo-b="').concat(this._id,'.container.menu">\n                  <ul class="padded">')),(o||a)&&d.push('\n                    <li><a data-icon="collapse" data-action="collapse" href="#" type="button" role="button" aria-label="'.concat(r().t("neo","Collapse"),'">').concat(r().t("neo","Collapse"),'</a></li>\n                    <li class="hidden"><a data-icon="expand" data-action="expand" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Expand"),'">').concat(r().t("neo","Expand"),"</a></li>")),d.push('\n                    <li><a data-icon="disabled" data-action="disable" href="#" type="button" role="button" aria-label="'.concat(r().t("neo","Disable"),'">').concat(r().t("neo","Disable"),'</a></li>\n                    <li class="hidden"><a data-icon="enabled" data-action="enable" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Enable"),'">').concat(r().t("neo","Enable"),'</a></li>\n                    <li class="hidden"><a data-icon="uarr" data-action="moveUp" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Move up"),'">').concat(r().t("neo","Move up"),'</a></li>\n                    <li class="hidden"><a data-icon="darr" data-action="moveDown" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Move down"),'">').concat(r().t("neo","Move down"),'</a></li>\n                  </ul>\n                  <hr>\n                  <ul class="padded">\n                    <li><a data-icon="plus" data-action="add" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Add block above"),'">').concat(r().t("neo","Add block above"),'</a></li>\n                    <li><a data-icon="field" data-action="copy" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Copy"),'">').concat(r().t("neo","Copy"),'</a></li>\n                    <li><a data-icon="brush" data-action="paste" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Paste"),'">').concat(r().t("neo","Paste"),'</a></li>\n                    <li><a data-icon="share" data-action="duplicate" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Clone"),'">').concat(r().t("neo","Clone"),'</a></li>\n                  </ul>\n                  <hr>\n                  <ul class="padded">\n                    <li><a class="error" data-icon="remove" data-action="delete" href="#" type="button" role="button" aria-label="').concat(r().t("neo","Delete"),'">').concat(r().t("neo","Delete"),'</a></li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n            <div class="ni_block_topbar_item block-reorder">\n              <a class="move icon" title="').concat(r().t("neo","Reorder"),'" aria-label="').concat(r().t("neo","Reorder"),'" role="button" data-neo-b="').concat(this._id,'.button.move"></a>\n            </div>\n          </div>\n        </div>')),(o||a)&&(d.push('\n        <div class="ni_block_body" data-neo-b="'.concat(this._id,'.container.body">')),o&&d.push('\n          <div class="ni_block_content" data-neo-b="'.concat(this._id,'.container.content">\n            ').concat(e.getHtml(this._id),"\n          </div>")),a&&this._renderOldChildBlocksContainer&&d.push('\n          <div class="ni_block_children" data-neo-b="'.concat(this._id,'.container.children">\n            <div class="ni_blocks" data-neo-b="').concat(this._id,'.container.blocks">\n            </div>\n            <div data-neo-b="').concat(this._id,'.container.buttons" class="hidden"></div>\n            <div data-neo-b="').concat(this._id,'.container.childrenWarnings" class="hidden">\n              <p class="first warning with-icon">').concat(r().t("neo","This Neo field's maximum number of levels has been reached, so no child blocks can be added here."),"</p>\n            </div>\n          </div>")),d.push("\n        </div>")),a&&d.push('\n        <div class="ni_block_collapsed-children" data-neo-b="'.concat(this._id,'.container.collapsedChildren"></div>')),d.push('\n      <div data-neo="container.buttons"></div>'),n()(d.join(""))},initUi:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this._initialised){if(this.$foot=n()(this._blockType.getJs(this._id)).filter(E),o().$bod.append(this.$foot),e&&r().initUiElements(this.$contentContainer),this.$tabsButton.menubtn(),this._settingsMenu=this.$settingsButton.data("trigger")||new(o().DisclosureMenu)(this.$settingsButton),this._settingsMenu.on("show",(function(){return t.$container.addClass("active")})),this._settingsMenu.on("hide",(function(){return t.$container.removeClass("active")})),this.$menuContainer=this._settingsMenu.$container,this.addListener(this.$menuContainer.find("[data-action]"),"click",this._handleActionClick),this.addListener(this.$menuContainer.find("[data-action]"),"keydown",this._handleActionKeydown),this._initialised=!0,this._buttons&&this._buttons.initUi(),o().requestAnimationFrame((function(){return t.updateResponsiveness()})),this.$container.on("mousedown",".matrixblock",(function(t){n()(this).addClass("neo-matrixblock")})),!this._modified&&!this.isNew()){this._initialState={enabled:this._enabled,level:this._level,content:o().getPostData(this.$contentContainer)};var i=function(){return t._detectChange()},a=new window.MutationObserver((function(){return setTimeout(i,200)}));if(a.observe(this.$container[0],{attributes:!0,childList:!0,characterData:!0,subtree:!0}),this.$contentContainer.on("propertychange change click","input, textarea, select, div.redactor-in",i),this.$contentContainer.on("paste input keyup",'input:not([type="hidden"]), textarea, div.redactor-in',i),this._detectChangeObserver=a,this.$contentContainer.length>0&&this.$contentContainer.html().match(/\[blocks\]\[new/)){this._forceModified=!0,this.setModified(!0);var s=this._templateNs[0]+"["+this._templateNs[1]+"]";r().modifiedDeltaNames.includes(s)||r().modifiedDeltaNames.push(s)}}C(this.$contentContainer),this.trigger("initUi")}},destroy:function(){this._initialised&&(this.$foot.remove(),clearInterval(this._detectChangeInterval),this._detectChangeObserver&&this._detectChangeObserver.disconnect(),this.trigger("destroy"))},getBlockType:function(){return this._blockType},getId:function(){return this._id},getLevel:function(){return this._level},setLevel:function(t){this._level=0|t,this.$levelInput.val("0".concat(this._level)),this.$container.toggleClass("is-level-odd",!!(this._level%2)),this.$container.toggleClass("is-level-even",!(this._level%2))},setModified:function(t){this._modified=t},getButtons:function(){return this._buttons},getSiteId:function(){if(!this._siteId){var t=this.$container.closest("form").find('input[name="siteId"]');this._siteId=t.val()}return this._siteId},getContent:function(){for(var t=o().getPostData(this.$contentContainer),e={},i=function(t,i){for(var o=e,a=0;a<t.length-1;a++){var r=t[a];n().isPlainObject(o[r])||n().isArray(o[r])||(o[r]={}),o=o[r]}o[t[t.length-1]]=i},a=0,r=Object.keys(t);a<r.length;a++){var s=r[a],l=c.parse(s).slice(this._templateNs.length+1);if(l.length)i(l,t[s])}return e},getParent:function(t){var e=this.getLevel(),n=t.indexOf(this),i=null;if(n>=0&&e>1)for(;null===i&&n>0;){var o=t[--n];o.getLevel()===e-1&&(i=o)}return i},getChildren:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getLevel(),i=t.indexOf(this),o=[];if(i>=0)for(var a=t[++i];a&&a.getLevel()>n;){var r=a.getLevel();(e?r>n:r===n+1)&&o.push(a),a=t[++i]}return o},getSiblings:function(t){return 1===this._level?t.filter((function(t){return 1===t.getLevel()})):this.getParent(t).getChildren(t)},getField:function(){return this._field},updatePreview:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t="boolean"==typeof t&&t;var e=this.$childrenContainer.find(".field"),i=this.$contentContainer.find(".field").add(e),a=[];i.each((function(){var e=n()(this),i=e.children(".input"),s=e.data("type"),l=e.children(".heading").children("label").text();if(null!==s){var c=!1;switch(s){case"craft\\fields\\Assets":var d=[],h=i.find(".element");h.each((function(){var e=n()(this),i=e.find(".elementthumb"),o=i.children("img").prop("srcset");if(o||(o=i.data("srcset")),d.push('<img sizes="30px" srcset="'.concat(o,'">')),!t&&1===h.length){var a=e.find(".title").text();d.push(S(O(a)))}})),c=d.join(" ");break;case"craft\\fields\\Categories":case"craft\\fields\\Entries":case"craft\\fields\\Tags":case"craft\\fields\\Users":var u=[];i.find(".element").each((function(){var t=n()(this).find(".title, .label").eq(0).text();u.push(S(O(t)))})),c=u.join(", ");break;case"craft\\fields\\Checkboxes":var f=[];i.find('input[type="checkbox"]').each((function(){if(this.checked){var t=n()(this).prop("id"),e=i.find('label[for="'.concat(t,'"]')).text();f.push(S(O(e)))}})),c=f.join(", ");break;case"craft\\fields\\Color":var p=i.find('input[type="color"]').val(),g=i.find('input[type="text"]').val(),b=i.find("div.colorhex").text(),v=null;v=p&&g?"background-color: ".concat(p):!p&&g?"background-color: ".concat(g):b?"background-color: ".concat(b):"background-image: repeating-linear-gradient(-45deg, transparent, transparent 2px, #777 2px, #777 3px)",c='<div class="preview_color" style="'.concat(v,'"></div>');break;case"craft\\fields\\Date":var k=S(i.find(".datewrapper input").val()),m=S(i.find(".timewrapper input").val());c=k&&m?k+" "+m:k||m;break;case"craft\\fields\\Dropdown":c=S(O(i.find("select").children(":selected").text()));break;case"craft\\fields\\Email":c=S(O(i.children('input[type="email"]').val()));break;case"craft\\fields\\Lightswitch":var _=!!i.find("input").val();c='<span class="status'.concat(_?" live":"",'"></span>')+S(O(l));break;case"craft\\fields\\MultiSelect":case"ttempleton\\categorygroupsfield\\fields\\CategoryGroupsField":var y=[];i.find("select").children(":selected").each((function(){y.push(n()(this).text())})),c=S(O(y.join(", ")));break;case"craft\\fields\\Number":case"craft\\fields\\PlainText":c=S(O(i.children('input[type="text"]').val()));break;case"craft\\fields\\RadioButtons":c=S(O(i.find('input[type="radio"]:checked').closest("label").text()));break;case"craft\\redactor\\Field":c=S(O(r().getText(i.find("textarea").val())));break;case"craft\\ckeditor\\Field":c=S(O(r().getText(i.find('[role="textbox"]').html())));break;case"craft\\fields\\Url":c=S(O(i.children('input[type="url"]').val()));break;case"craft\\fields\\Matrix":case"verbb\\supertable\\fields\\SuperTableField":var B=e.find(".field").find('input[type!="hidden"], select, textarea, .label'),C=[];B.each((function(){var t=n()(this),e=null;t.is("input, textarea")?e=r().getText(o().getInputPostVal(t)):t.is("select")?e=t.find("option:selected").text():t.hasClass("label")&&(e=t.text()),e&&C.push(O(e))})),c=S(C.join(", "));break;case"typedlinkfield\\fields\\LinkField":case"fruitstudios\\linkit\\fields\\LinkitField":var x=[],$=i.find("select").children(":selected").first(),w=i.find('.linkfield--typeOption:not(.hidden), [class^="linkit--"]:not(.hidden)'),T=w.find('input[type!="hidden"]').val(),I=w.find(".element"),E=i.find('.field[id*="customText"] input, .linkit--customText input').val();if(x.push(O($.text())),T&&x.push(O(T)),I.length>0){var M=I.find(".title, .label").eq(0).text();x.push(O(M))}E&&x.push(O(E)),c=S(x.join(", "));break;case"luwes\\codemirror\\fields\\CodeMirrorField":var N=[];e.find(".CodeMirror-line > span").each((function(){N.push(n()(this).text())})),c=S(N.join(" "));break;case"rias\\positionfieldtype\\fields\\Position":c=S(i.find(".btn.active").prop("title"));break;case"wrav\\oembed\\fields\\OembedField":c=S(O(i.children("input").val()))}c&&a.length<10&&a.push('<span class="preview_section">',c,"</span>")}})),this.$previewContainer.html(a.join(""))},isNew:function(){return/^new/.test(this.getId())},isSelected:function(){return this.$container.hasClass("is-selected")},collapse:function(t,e){this.toggleExpansion(!1,t,e)},expand:function(t,e){this.toggleExpansion(!0,t,e)},toggleExpansion:function(t,e,n){var i=this;if(t="boolean"==typeof t?t:!this._expanded,e="boolean"!=typeof e||e,n=!o().prefersReducedMotion()&&("boolean"!=typeof n||n),t!==this._expanded){this._expanded=t;var a=this.$menuContainer.find('[data-action="expand"]').parent(),r=this.$menuContainer.find('[data-action="collapse"]').parent();this.$container.toggleClass("is-expanded",this._expanded).toggleClass("is-collapsed",!this._expanded),a.toggleClass("hidden",this._expanded),r.toggleClass("hidden",!this._expanded),this._expanded||this.updatePreview();var s={opacity:1,height:(0|this.$contentContainer.outerHeight())+(0|this.$childrenContainer.outerHeight())},l={opacity:0,height:0},c={opacity:"",height:""};n?this.$bodyContainer.css(this._expanded?l:s).velocity(this._expanded?s:l,"fast",(function(t){i._expanded&&i.$bodyContainer.css(c)})):this.$bodyContainer.css(this._expanded?c:l),e&&this.saveExpansion(),this.trigger("toggleExpansion",{expanded:this._expanded})}},isExpanded:function(){return this._expanded},saveExpansion:function(){if(!this.isNew()){var t=this.getId(),e=n()("#main-form").data("elementEditor"),i=e.duplicatedElements[t],o=e.settings.isProvisionalDraft&&void 0!==i?i:t,a={expanded:this.isExpanded()?1:0,blockId:o,siteId:this.getSiteId()};r().queue.push((function(){return new Promise((function(t,e){r().sendActionRequest("POST","neo/input/save-expansion",{data:a}).then(t).catch(e)}))}))}},disable:function(){this.toggleEnabled(!1)},enable:function(){this.toggleEnabled(!0)},toggleEnabled:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._enabled;if(t!==this._enabled){this._enabled=t;var e=this.$menuContainer.find('[data-action="enable"]').parent(),n=this.$menuContainer.find('[data-action="disable"]').parent();this.$container.toggleClass("is-enabled",this._enabled).toggleClass("is-disabled",!this._enabled),this.$status.toggleClass("hidden",this._enabled),e.toggleClass("hidden",this._enabled),n.toggleClass("hidden",!this._enabled),this.$enabledInput.val(this._enabled?1:0),this.trigger("toggleEnabled",{enabled:this._enabled})}},isEnabled:function(){return this._enabled},toggleShowButtons:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this._showButtons;this.$buttonsContainer.toggleClass("hidden",!t),this.$childrenWarningsContainer.toggleClass("hidden",t)},selectTab:function(t){this.$tabButton.removeClass("is-selected"),this.$tabContainer.addClass("hidden");var e=this.$tabButton.filter('[data-neo-b-info="'.concat(t,'"]')).addClass("is-selected"),n=this.$tabContainer.filter('[data-id="tab--'.concat(t.toLowerCase(),'"]')).removeClass("hidden");this.$tabsButton.text(t),r().ElementThumbLoader.retryAll(),this.trigger("selectTab",{tabName:t,$tabButton:e,$tabContainer:n})},updateResponsiveness:function(){if(void 0===this._topbarLeftWidth){var t=this._expanded?0:this.$previewContainer.width();this._topbarLeftWidth=this.$topbarLeftContainer.width()-t}this._topbarRightWidth=this._topbarRightWidth||this.$topbarRightContainer.width();var e=this.$topbarContainer.width()<this._topbarLeftWidth+this._topbarRightWidth;this.$tabsContainer.toggleClass("invisible",e),this.$tabsButton.toggleClass("invisible",!e)},updateMenuStates:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;o="boolean"!=typeof o||o;var s=this.getBlockType(),l=n.filter((function(t){return t.getBlockType().getHandle()===s.getHandle()})),c=s.getMaxBlocks(),d=this.getSiblings(n),h=n.filter((function(t){return 0===t.getLevel()})).length,u=i>0&&n.length>=i,f=r>0&&h>=r,p=u||f||!o,g=c>0&&l.length>=c,b=p||g,v=JSON.parse(window.localStorage.getItem("neo:copy")||"{}"),k=p||!v.blocks||!v.field||v.field!==t,m=this.getParent(n);if(!k&&m){var _=m.getBlockType().getMaxChildBlocks();if(_>0){var y=m.getChildren(n).length,B=v.blocks.length;k=k||y+B>_}}if(!k||!b){var C=this.getBlockType().getMaxSiblingBlocks();if(C>0){var $=function(t){return Object.prototype.hasOwnProperty.call(t,"type")?t.type===e.getBlockType().getId():"function"==typeof t.getBlockType&&t.getBlockType().getHandle()===e.getBlockType().getHandle()},w=d.filter($,this).length,T=v.blocks?v.blocks.filter($,this).length:0;k=k||w+T>C,b=b||w>=C}}if(!k){var I,E=n.reduce((function(t,e){var n=e.getBlockType(),i=n.getId(),o=t[i]||{blockType:n,count:0};return o.count++,t[i]=o,t})),S=x(v.blocks);try{var O=function(){var t=I.value,e=E[t.type];if(e){var n=e.blockType,i=e.count,o=n.getMaxBlocks();k=k||o>0&&i>=o}if(1===t.level){var r=a.find((function(e){return e.getId()===t.type}));k=k||!r}};for(S.s();!(I=S.n()).done;)O()}catch(t){S.e(t)}finally{S.f()}}var M=d.indexOf(this),N=M<=0,L=[-1,d.length-1].includes(M);this.$menuContainer.find('[data-action="moveUp"]').parent().toggleClass("hidden",N),this.$menuContainer.find('[data-action="moveDown"]').parent().toggleClass("hidden",L),this.$menuContainer.find('[data-action="add"]').toggleClass("disabled",p),this.$menuContainer.find('[data-action="duplicate"]').toggleClass("disabled",b),this.$menuContainer.find('[data-action="paste"]').toggleClass("disabled",k)},_handleActionClick:function(t){t.preventDefault(),this["@settingSelect"](t)},_handleActionKeydown:function(t){t.keyCode===o().SPACE_KEY&&(t.preventDefault(),this["@settingSelect"](t))},_detectChange:function(){if(window.draftEditor&&window.draftEditor.enableAutosave&&window.draftEditor.settings.draftId&&(this.setModified(!0),this._forceModified=!0),!this._forceModified){var t=this._initialState,e=o().getPostData(this.$contentContainer),n=!r().compare(e,t.content,!1)||t.enabled!==this._enabled||t.level!==this._level;n!==this._modified&&this.setModified(n)}},"@settingSelect":function(t){this._settingsMenu.hide();var e=n()(t.target);if(!e.hasClass("disabled"))switch(e.attr("data-action")){case"collapse":this.collapse();break;case"expand":this.expand();break;case"disable":this.disable(),this.collapse();break;case"enable":this.enable(),this.expand();break;case"moveUp":this.trigger("moveUpBlock",{block:this});break;case"moveDown":this.trigger("moveDownBlock",{block:this});break;case"delete":this.trigger("removeBlock",{block:this});break;case"add":this.trigger("addBlockAbove",{block:this});break;case"copy":this.trigger("copyBlock",{block:this});break;case"paste":this.trigger("pasteBlock",{block:this});break;case"duplicate":this.trigger("duplicateBlock",{block:this})}},"@doubleClickTitle":function(t){t.preventDefault();var e=n()(t.target).parent(),i=e.closest(this.$topbarLeftContainer).length>0,o=e.closest(this.$topbarRightContainer).length>0;i||o||(window.draftEditor&&window.draftEditor.pause(),this.toggleExpansion(),window.draftEditor&&window.draftEditor.resume())},"@setTab":function(t){t.preventDefault();var e=n()(t.currentTarget).attr("data-neo-b-info");this.selectTab(e)}},{_totalNewBlocks:0,getNewId:function(){return"new".concat(this._totalNewBlocks++)}});function N(t){return function(t){if(Array.isArray(t))return A(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||L(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(t,e){if(t){if("string"==typeof t)return A(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(t,e):void 0}}function A(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var D={blockTypes:[],groups:[],items:null,maxBlocks:0,maxTopBlocks:0,blocks:null};const P=o().Base.extend({_blockTypes:[],_groups:[],_maxBlocks:0,_maxTopBlocks:0,init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(t=Object.assign({},D,t)).items?(this._items=Array.from(t.items),this._blockTypes=this._items.filter((function(t){return"blockType"===t.getType()})),this._groups=this._items.filter((function(t){return"group"===t.getType()}))):(this._blockTypes=Array.from(t.blockTypes),this._groups=Array.from(t.groups),this._items=[].concat(N(this._blockTypes),N(this._groups)).sort((function(t,e){return t.getSortOrder()-e.getSortOrder()}))),this._maxBlocks=0|t.maxBlocks,this._maxTopBlocks=0|t.maxTopBlocks,this.$container=this._generateButtons();var e=this.$container.find("[data-neo-bn]");this.$buttonsContainer=e.filter('[data-neo-bn="container.buttons"]'),this.$menuContainer=e.filter('[data-neo-bn="container.menu"]'),this.$blockButtons=e.filter('[data-neo-bn="button.addBlock"]'),this.$groupButtons=e.filter('[data-neo-bn="button.group"]'),t.blocks&&this.updateButtonStates(t.blocks),this.addListener(this.$blockButtons,"activate","@newBlock")},_generateButtons:function(){var t=[],e=null,i=!0;t.push('\n      <div class="ni_buttons">\n        <div class="btngroup" data-neo-bn="container.buttons">');for(var o=0;o<this._items.length;o++){var a=this._items[o],s=a.getType();"blockType"===s?null!==e?t.push('\n            <li>\n              <a data-neo-bn="button.addBlock" data-neo-bn-info="'.concat(a.getHandle(),'">').concat(a.getName(),"</a>\n            </li>")):(t.push('\n          <div class="btn dashed'.concat(i?" add icon":"",'" data-neo-bn="button.addBlock" data-neo-bn-info="').concat(a.getHandle(),'">\n            ').concat(a.getName(),"\n          </div>")),i=!1):"group"===s&&(null!==e&&t.push("\n          </ul>\n        </div>"),null!==(e=a.isBlank()||!a.getAlwaysShowDropdown()&&(o+2>=this._items.length||"group"===this._items[o+2].getType())?null:a)&&(t.push('\n        <div class="btn dashed'.concat(i?" add icon":"",' menubtn" data-neo-bn="button.group">\n          ').concat(a.getName(),'\n        </div>\n        <div class="menu">\n          <ul>')),i=!1))}null!==e&&t.push("\n            </ul>\n          </div>"),t.push('\n        </div>\n        <div class="btn dashed add icon menubtn hidden" data-neo-bn="container.menu">\n          '.concat(r().t("neo","Add a block"),"\n        </div>")),e=null;var l=!1;t.push('\n        <div class="menu">\n          <ul>');var c,d=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=L(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw a}}}}(this._items);try{for(d.s();!(c=d.n()).done;){var h=c.value,u=h.getType();"blockType"===u?(null===e||l||(l=!0,t.push("\n              <h6>".concat(e.getName(),'</h6>\n              <ul class="padded">'))),t.push('\n            <li>\n              <a data-neo-bn="button.addBlock" data-neo-bn-info="'.concat(h.getHandle(),'">\n                ').concat(h.getName(),"\n              </a>\n            </li>"))):"group"===u&&((null===e||l)&&t.push("\n              </ul>"),l=!1,null===(e=h.isBlank()?null:h)&&t.push("\n              <ul>"))}}catch(t){d.e(t)}finally{d.f()}return t.push("\n          </ul>\n        </div>\n      </div>"),n()(t.join(""))},initUi:function(){n()(".menubtn",this.$container).menubtn(),this.updateResponsiveness()},getBlockTypes:function(){return Array.from(this._blockTypes)},getGroups:function(){return Array.from(this._groups)},getMaxBlocks:function(){return this._maxBlocks},updateButtonStates:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e="boolean"!=typeof e||e;var o=this,a=t.filter((function(t){return 1===t.getLevel()})).length,r=this._maxBlocks>0&&t.length>=this._maxBlocks,s=this._maxTopBlocks>0&&a>=this._maxTopBlocks,l=r||s||!e;this.$blockButtons.each((function(){var e=n()(this),a=l;if(!a){var r=function(t){return t.getBlockType().getHandle()===s.getHandle()},s=o.getBlockTypeByButton(e),c=t.filter(r),d=s.getMaxBlocks(),h=s.getMaxSiblingBlocks(),u=null!==i?i.getChildren(t).filter(r):t.filter((function(t){return 1===t.getLevel()&&t.getBlockType().getHandle()===s.getHandle()}));a=a||d>0&&c.length>=d||h>0&&u.length>=h}e.toggleClass("disabled",a)})),this.$groupButtons.each((function(){var t=n()(this),e=t.data("menubtn"),i=l;if(!i&&e){var o=e.menu.$options;i=o.length===o.filter(".disabled").length}t.toggleClass("disabled",i)}))},updateResponsiveness:function(){this._buttonsContainerWidth||(this._buttonsContainerWidth=this.$buttonsContainer.width());var t=this.$container.width()<this._buttonsContainerWidth;this.$buttonsContainer.toggleClass("hidden",t),this.$menuContainer.toggleClass("hidden",!t)},getBlockTypeByButton:function(t){var e=t.attr("data-neo-bn-info");return this._blockTypes.find((function(t){return t.getHandle()===e}))},"@newBlock":function(t){var e=n()(t.currentTarget).attr("data-neo-bn-info"),i=this._blockTypes.find((function(t){return t.getHandle()===e}));this.trigger("newBlock",{blockType:i})}});function j(t){return function(t){if(Array.isArray(t))return U(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||R(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=R(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==n.return||n.return()}finally{if(s)throw a}}}}function R(t,e){if(t){if("string"==typeof t)return U(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(t,e):void 0}}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var F={name:null,namespace:[],blockTypes:[],groups:[],blocks:[],inputId:null,maxBlocks:0,maxTopBlocks:0,maxLevels:0};const Y=o().Base.extend({_templateNs:[],_name:null,_siteId:null,init:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object.assign({},F,e),this._templateNs=c.parse(e.namespace),this._blockTypes=[],this._groups=e.groups.map((function(t){return new B(t)})),this._blocks=[],this._name=e.name,this._maxBlocks=e.maxBlocks,this._maxTopBlocks=e.maxTopBlocks,this._maxLevels=e.maxLevels,this._ownerId=null;var i=n()('[name="setId"], [name="entryId"], [name="categoryId"]');i.length&&(this._ownerId=i.val()),this.$container=n()("#"+e.inputId);var a={};this._groups.forEach((function(t){a[t.getId()]=!0}));var r,s={},l=H(e.blockTypes);try{for(l.s();!(r=l.n()).done;){var d=r.value;if(null===d.groupId||void 0!==a[d.groupId]){var h=new _(d);this._blockTypes.push(h),s[h.getHandle()]=h}}}catch(t){l.e(t)}finally{l.f()}var u=this.$container.closest("form");this._siteId=u.find('input[name="siteId"]').val();var f=this.$container.find("[data-neo]");this.$blocksContainer=f.filter('[data-neo="container.blocks"]'),this.$buttonsContainer=f.filter('[data-neo="container.buttons"]'),this._buttons=new P({blockTypes:this.getBlockTypes(!0),groups:this.getGroups(),maxBlocks:this.getMaxBlocks(),maxTopBlocks:this.getMaxTopBlocks()}),this.$buttonsContainer.append(this._buttons.$container),this._buttons.on("newBlock",(function(e){return t["@newBlock"](e)})),this._buttons.initUi(),this._blockSort=new b({container:this.$blocksContainer,handle:'[data-neo-b$=".button.move"]',maxTopBlocks:this.getMaxTopBlocks(),filter:function(){return t._blockSort.$targetItem.hasClass("is-selected")?t._blockSelect.getSelectedItems():t._blockSort.$targetItem},collapseDraggees:!0,magnetStrength:4,helperLagBase:1.5,helperOpacity:.9,onDragStop:function(){t._updateBlockOrder(),t._updateButtons()}}),this._blockSelect=new(o().Select)(this.$blocksContainer,null,{multi:!0,vertical:!0,handle:'> .ni_block_topbar [data-neo-b$=".select"]',checkboxMode:!0,selectedClass:"is-selected sel"}),this.$blocksContainer.find(".ni_block").each((function(e,i){var o=n()(i),a={};a.id=o.attr("data-neo-b-id"),a.sortOrder=e,a.collapsed=o.hasClass("is-collapsed"),a.enabled=!!o.find('[data-neo-b="'.concat(a.id,'.input.enabled"]')).val(),a.level=parseInt(o.find('[data-neo-b="'.concat(a.id,'.input.level"]')).val()),a.field=t,a.namespace=[].concat(j(t._templateNs),[a.id]);var r=o.find('[data-neo-b="'.concat(a.id,'.input.type"]')).val(),l=s[r];a.blockType=new _({id:l.getId(),fieldLayoutId:l.getFieldLayoutId(),name:l.getName(),handle:l.getHandle(),maxBlocks:l.getMaxBlocks(),maxSiblingBlocks:l.getMaxSiblingBlocks(),maxChildBlocks:l.getMaxChildBlocks(),childBlocks:l.getChildBlocks(),topLevel:l.getTopLevel(),hasChildBlocksUiElement:l.hasChildBlocksUiElement()}),a.buttons=new P({items:l.getChildBlockItems(t.getItems()),maxBlocks:t.getMaxBlocks()}),a.showButtons=!t.atMaxLevels(a.level);var c=new M(a);c.initUi(!1),t._setBlockEvents(c),t._blocks.push(c),t._blockSort.addBlock(c),t._blockSelect.addItems(c.$container)})),this._updateBlockOrder(),this._updateBlockChildren(),this._updateButtons(),this.addListener(this.$container,"resize",(function(){return t.updateResponsiveness()}));var p="function"==typeof u.data("serializer")?u.data("serializer")():u.serialize();u.data("initialSerializedValue",p),this._setMatrixClassErrors(),this._setBlockTypeClassErrors(),this._blocks.filter((function(t){return!t.isExpanded()})).forEach((function(t){return t.updatePreview()})),this.trigger("afterInit")},updateResponsiveness:function(){var t,e=H(this._blocks);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.updateResponsiveness();var i=n.getButtons();i&&i.updateResponsiveness()}}catch(t){e.e(t)}finally{e.f()}this._buttons.updateResponsiveness(),this._tempButtons&&this._tempButtons.updateResponsiveness()},addBlock:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this._blocks.length;e=e>=0?Math.max(0,Math.min(e,a)):a,i=!o().prefersReducedMotion()&&("boolean"!=typeof i||i);var r=e>0&&this._blocks[e-1],s=e<a&&this._blocks[e];if(r){var l=s?s.getLevel():1,c=r.getLevel()+(r.getBlockType().isParent()?1:0);n=Math.max(l,Math.min(n,c));var d=this._findPrevBlockOnLevel(e,n);d?d.$container.after(t.$container):r.$blocksContainer.prepend(t.$container)}else this.$blocksContainer.prepend(t.$container);t.setLevel(n),this._blocks.push(t),this._blockSort.addBlock(t),this._blockSelect.addItems(t.$container),t.initUi(),this._setBlockEvents(t),this._destroyTempButtons(),this._updateBlockOrder(),this._updateBlockChildren(),this._updateButtons(),i&&t.$container.css({opacity:0,marginBottom:-t.$container.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(function(e){return o().requestAnimationFrame((function(){return o().scrollContainerToElement(t.$container)}))})),this.trigger("addBlock",{block:t,index:e})},removeBlock:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;window.draftEditor&&window.draftEditor.pause(),n=!o().prefersReducedMotion()&&("boolean"!=typeof n||n),i="boolean"==typeof i&&i;var a,r=this._findChildBlocks(this._blocks.indexOf(t)),s=H(r);try{for(s.s();!(a=s.n()).done;){var l=a.value;this.removeBlock(l,!0,!0)}}catch(t){s.e(t)}finally{s.f()}t.off(".input"),this._blocks=this._blocks.filter((function(e){return e!==t})),this._blockSort.removeItems(t.$container),this._blockSelect.removeItems(t.$container),this._destroyTempButtons(),this._updateButtons();var c=function(){t.$container.remove(),e._updateBlockChildren(),window.draftEditor&&window.draftEditor.resume()};n?t.$container.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:i?10:-t.$container.outerHeight()},"fast",(function(t){return c()})):c(),t.destroy(),this.trigger("removeBlock",{block:t})},_setBlockEvents:function(t){var e=this;t.on("removeBlock.input",(function(n){e.getSelectedBlocks().length>1?window.confirm(r().t("neo","Are you sure you want to delete the selected blocks?"))&&e._blockBatch(t,(function(t){return e.removeBlock(t)})):e.removeBlock(t)})),t.on("toggleEnabled.input",(function(n){return e._blockBatch(t,(function(t){return t.toggleEnabled(n.enabled)}))})),t.on("toggleExpansion.input",(function(n){return e._blockBatch(t,(function(t){return t.toggleExpansion(n.expanded)}))})),t.on("moveUpBlock.input",(function(n){return e._moveBlock(t,"up")})),t.on("moveDownBlock.input",(function(n){return e._moveBlock(t,"down")})),t.on("newBlock.input",(function(n){return e["@newBlock"](Object.assign(n,{index:e._getNextBlockIndex(t)}))})),t.on("addBlockAbove.input",(function(t){return e["@addBlockAbove"](t)})),t.on("copyBlock.input",(function(t){return e["@copyBlock"](t)})),t.on("pasteBlock.input",(function(t){return e["@pasteBlock"](t)})),t.on("duplicateBlock.input",(function(t){return e["@duplicateBlock"](t)}))},_moveBlock:function(t,e){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(["up","down"].includes(e)){window.draftEditor&&window.draftEditor.pause();var a=t.getSiblings(this.getBlocks()),r=a.indexOf(t),s=r>0&&"up"===e,l=r<a.length-1&&"down"===e;if(-1!==r&&s!==l){var c=!o().prefersReducedMotion()&&("boolean"!=typeof i||i),d=t.$container,h=function(){d.detach(),s?a[r-1].$container.before(d):a[r+1].$container.after(d)},u=function(){n._updateBlockOrder(),n._updateButtons(),window.draftEditor&&window.draftEditor.resume()};c?d.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:-d.outerHeight()},"fast",(function(t){h(),d.css({opacity:0,marginBottom:-d.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(function(t){u(),o().requestAnimationFrame((function(){return o().scrollContainerToElement(d)}))}))})):(h(),u())}}},getBlockByElement:function(t){return this._blocks.find((function(e){return e.$container.is(t)}))},getBlocks:function(){return Array.from(this._blocks)},getBlockTypeById:function(t){return this._blockTypes.find((function(e){return e.getId()===t}))},getBlockTypeByHandle:function(t){return this._blockTypes.find((function(e){return e.getHandle()===t}))},getBlockTypes:function(t){return(t="boolean"==typeof t&&t)?this._blockTypes.filter((function(t){return t.getTopLevel()})):Array.from(this._blockTypes)},getGroups:function(){return Array.from(this._groups)},getItems:function(){return[].concat(j(this.getBlockTypes()),j(this.getGroups())).sort((function(t,e){return t.getSortOrder()-e.getSortOrder()}))},getMaxBlocks:function(){return this._maxBlocks},getMaxTopBlocks:function(){return this._maxTopBlocks},getMaxLevels:function(){return this._maxLevels},atMaxLevels:function(t){return this._maxLevels>0&&t+1>this._maxLevels},getSelectedBlocks:function(){var t=this._blockSelect.getSelectedItems();return this._blocks.filter((function(e){return e.$container.closest(t).length>0}))},_setMatrixClassErrors:function(){var t=n()(".ni_block_body .matrix-field .input.errors");t.length&&t.each((function(){var t=n()(this),e=t.closest(".ni_block_content_tab").data("neo-b-info"),i=t.closest(".ni_block").find('.tabs .tab[data-neo-b-info="'+e+'"]');i.length&&i.addClass("has-errors")}))},_setBlockTypeClassErrors:function(){var t=n()(".ni_block .tab.has-errors");t.length&&t.each((function(){t.parents(".ni_block.is-collapsed").each((function(){n()(this).find("> .ni_block_topbar .title .blocktype").addClass("has-errors")}))}))},_updateBlockOrder:function(){var t=this,e=[];this.$blocksContainer.find(".ni_block").each((function(n,i){var o=t.getBlockByElement(i);e.push(o)})),this._blocks=e},_updateBlockChildren:function(){var t,e=H(this._blocks);try{for(e.s();!(t=e.n()).done;){for(var n=t.value,i=n.$blocksContainer.children(".ni_block"),o=Math.min(i.length,8),a=[],r=0;r<o;r++)a.push('<div class="ni_block_collapsed-children_child"></div>');n.$collapsedChildrenContainer.html(a.join(""))}}catch(t){e.e(t)}finally{e.f()}},_checkMaxChildren:function(t){if(!t)return!0;var e=t.getBlockType().getMaxChildBlocks();return!(e>0)||this._findChildBlocks(t).length<e},_updateButtons:function(){var t=this,e=this.getBlocks();this._buttons.updateButtonStates(e),this._tempButtons&&this._tempButtons.updateButtonStates(e,this._checkMaxChildren(this._tempButtonsBlock));var n,i=H(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=this._findParentBlock(o),r=a?a.getBlockType():null,s=o.getButtons(),l=o.getLevel(),c=r?r.getChildBlocks():this.getBlockTypes(!0);!0===c||"*"===c?c=this.getBlockTypes(!1):Array.isArray(c)&&(c=c.map((function(e){return"string"==typeof e?t.getBlockTypeByHandle(e):e}))),o.updateMenuStates(this._name,e,this.getMaxBlocks(),this._checkMaxChildren(a),c,1===l?this.getMaxTopBlocks():0),s&&s.updateButtonStates(e,this._checkMaxChildren(o),o),o.toggleShowButtons(!this.atMaxLevels(l))}}catch(t){i.e(t)}finally{i.f()}},_blockBatch:function(t,e){var n,i=H(t.isSelected()?this.getSelectedBlocks():[t]);try{for(i.s();!(n=i.n()).done;){e(n.value)}}catch(t){i.e(t)}finally{i.f()}},_destroyTempButtons:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t=!o().prefersReducedMotion()&&("boolean"!=typeof t||t),this._tempButtons){var e=this._tempButtons;e.off("newBlock"),t?e.$container.css({opacity:1,marginBottom:10}).velocity({opacity:0,marginBottom:-e.$container.outerHeight()},"fast",(function(t){return e.$container.remove()})):e.$container.remove(),this._tempButtons=null,this._tempButtonsBlock=null}},_findPrevBlockOnLevel:function(t,e){t instanceof M&&(t=this._blocks.indexOf(t));for(var n=this._blocks[--t],i=Number.MAX_VALUE;n;){var o=n.getLevel();if(o<i){if(o===e)return n;i=o}n=this._blocks[--t]}return!1},_findChildBlocks:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t instanceof M&&(t=this._blocks.indexOf(t)),e="boolean"==typeof e&&e;var n=this._blocks[t];return n?n.getChildren(this._blocks,e):[]},_findParentBlock:function(t){t instanceof M&&(t=this._blocks.indexOf(t));var e=this._blocks,n=e[t];if(n){var i=n.getLevel();if(i>1){for(var o=t,a=n;a&&a.getLevel()>=i;)a=e[--o];return a}}return null},_getNextBlockIndex:function(t){t instanceof M&&(t=this._blocks.indexOf(t));var e=this._findChildBlocks(t,!0),n=e[e.length-1];return(n?this._blocks.indexOf(n):t)+1},_duplicate:function(t,e){var i=this;window.draftEditor&&window.draftEditor.pause();var a=!o().prefersReducedMotion(),s=n()('<div class="ni_spinner">'.concat(a?'<div class="spinner"></div>':"Loading block","</div>"));e.$container.after(s);var l=!1,c=function(){};a?s.css({opacity:0,marginBottom:-s.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(function(){l=!0,c()})):(l=!0,c()),r().postActionRequest("neo/input/render-blocks",t,(function(t){if(t.success&&t.blocks.length>0){var n,r=[],d=H(t.blocks);try{for(d.s();!(n=d.n()).done;){var h=n.value,u=M.getNewId(),f=i.getBlockTypeById(h.type),p=new _({id:f.getId(),fieldLayoutId:f.getFieldLayoutId(),name:f.getName(),handle:f.getHandle(),maxBlocks:f.getMaxBlocks(),maxSiblingBlocks:f.getMaxSiblingBlocks(),maxChildBlocks:f.getMaxChildBlocks(),childBlocks:f.getChildBlocks(),topLevel:f.getTopLevel(),tabs:h.tabs}),g=new P({items:p.getChildBlockItems(i.getItems()),maxBlocks:i.getMaxBlocks()}),b=new M({namespace:[].concat(j(i._templateNs),[u]),field:i,blockType:p,id:u,level:0|h.level,buttons:g,enabled:!!h.enabled,collapsed:!!h.collapsed,showButtons:!i.atMaxLevels(0|h.level)},!0);r.push(b)}}catch(t){d.e(t)}finally{d.f()}c=function(){var t,n=i._getNextBlockIndex(e),l=H(r);try{for(l.s();!(t=l.n()).done;){var c=t.value;i.addBlock(c,n++,c.getLevel(),!1)}}catch(t){l.e(t)}finally{l.f()}if(a){var d=r[0];d.$container.css({opacity:0,marginBottom:s.outerHeight()-d.$container.outerHeight()+10}).velocity({opacity:1,marginBottom:10},"fast",(function(t){return o().requestAnimationFrame((function(){return o().scrollContainerToElement(d.$container)}))}))}s.remove(),window.draftEditor&&window.draftEditor.resume()},l&&c()}}))},"@newBlock":function(t){var e=M.getNewId(),n=new M({namespace:[].concat(j(this._templateNs),[e]),field:this,blockType:t.blockType,id:e,buttons:new P({items:t.blockType.getChildBlockItems(this.getItems()),maxBlocks:this.getMaxBlocks()}),showButtons:!this.atMaxLevels(t.level)},!0);this.addBlock(n,t.index,t.level)},"@addBlockAbove":function(t){var e=this;this._destroyTempButtons();var n=!o().prefersReducedMotion()&&!1!==t.animate,i=t.block,a=this._blocks.indexOf(i),r=this._findParentBlock(a),s=this.getBlocks(),l=new P({blockTypes:r?[]:this.getBlockTypes(!0),blocks:s,groups:r?[]:this.getGroups(),items:r?r.getBlockType().getChildBlockItems(this.getItems()):null,maxBlocks:this.getMaxBlocks()});i.$container.before(l.$container),l.on("newBlock",(function(t){return e["@newBlock"]({blockType:t.blockType,index:a,level:i.getLevel()})})),l.initUi(),n&&l.$container.css({opacity:0,marginBottom:-l.$container.outerHeight()}).velocity({opacity:1,marginBottom:10},"fast",(function(t){return o().requestAnimationFrame((function(){return o().scrollContainerToElement(l.$container)}))})),this._tempButtons=l,this._tempButtonsBlock=this._findParentBlock(i),this._tempButtons.updateButtonStates(s,this._checkMaxChildren(this._tempButtonsBlock),this._tempButtonsBlock)},"@copyBlock":function(t){var e=this,n=[],i=0,o=this._ownerId;this._blockBatch(t.block,(function(t){if(!(i>0&&-1!==n[n.length-1].indexOf(t))){var o=[];o.push.apply(o,[t].concat(j(e._findChildBlocks(t,!0)))),n.push(o),i+=o.length}}));for(var a={field:this._name,blocks:[]},s=0,l=n;s<l.length;s++){var c,d=l[s],h=d[0].getLevel(),u=H(d);try{for(u.s();!(c=u.n()).done;){var f=c.value,p={type:f.getBlockType().getId(),level:f.getLevel()-h,content:f.getContent(),ownerId:o};f.isEnabled()&&(p.enabled=1),f.isExpanded()||(p.collapsed=1),a.blocks.push(p)}}catch(t){u.e(t)}finally{u.f()}}window.localStorage.setItem("neo:copy",JSON.stringify(a)),this._updateButtons();var g=1===i?"1 block copied":"{n} blocks copied";r().cp.displayNotice(r().t("neo",g,{n:i}))},"@pasteBlock":function(t){var e=t.block,n=e.getLevel(),i=window.localStorage.getItem("neo:copy");if(i){var o,a=JSON.parse(i).blocks,r=H(a);try{for(r.s();!(o=r.n()).done;){var s=o.value;s.level+=n}}catch(t){r.e(t)}finally{r.f()}c.enter(this._templateNs);var l={namespace:c.toFieldName(),siteId:this._siteId,blocks:a};c.leave(),this._duplicate(l,e)}},"@duplicateBlock":function(t){var e=t.block,n=this._blocks.indexOf(e),i=this._findChildBlocks(n,!0),o=this._ownerId,a=function(t){return{collapsed:0|!t.isExpanded(),content:t.getContent(),enabled:0|t.isEnabled(),level:t.getLevel(),ownerId:o,type:t.getBlockType().getId()}};c.enter(this._templateNs);var r={namespace:c.toFieldName(),siteId:this._siteId,blocks:[a(e)].concat(j(i.map(a)))};c.leave(),this._duplicate(r,e)}});var W="undefined"!=typeof window?window:void 0,q=[];W.Neo={Input:Y,inputs:q,createInput:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new Y(t);return q.push(e),e}}})();